<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POWERGRID Material Demand Forecasting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#FDFBF7',
                        'jungle-green': '#064E3B',
                        'pop-pink': '#F472B6',
                        'lime-accent': '#D9F99D'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 10px 40px -10px rgba(0,0,0,0.08)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Smooth Scrolling */
        html { scroll-behavior: smooth; }
        
        /* Fade In Up Animation */
        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(50px);
            transition: all 1.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Glassmorphism for Hero SVG */
        .glass-panel {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        
        /* Hide scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #FDFBF7;
        }
        ::-webkit-scrollbar-thumb {
            background: #E5E7EB;
            border-radius: 4px;
        }
        
        /* Dashboard Styles */
        .nav-link {
            transition: all 0.2s ease;
        }
        
        .nav-link:hover {
            background: #334155;
            color: #2dd4bf;
        }
        
        .nav-link.active {
            background: #1e293b;
            color: #2dd4bf;
            border-left: 4px solid #2dd4bf;
        }
        
        /* Dark Theme Styles */
        body.dark-theme #app .flex.h-screen {
            background: #0f172a;
        }
        
        body.dark-theme #sidebar {
            background: #020617;
            border-color: #1e293b;
        }
        
        body.dark-theme header {
            background: #1e293b;
            border-color: #334155;
        }
        
        body.dark-theme #page-title {
            color: #e2e8f0;
        }
        
        body.dark-theme #main-content {
            background: #0f172a;
        }
        
        body.dark-theme .bg-white {
            background: #1e293b !important;
        }
        
        body.dark-theme .text-slate-800 {
            color: #e2e8f0 !important;
        }
        
        body.dark-theme .text-slate-700 {
            color: #cbd5e1 !important;
        }
        
        body.dark-theme .text-slate-600 {
            color: #94a3b8 !important;
        }
        
        body.dark-theme .text-slate-500 {
            color: #64748b !important;
        }
        
        body.dark-theme .border-slate-200 {
            border-color: #334155 !important;
        }
        
        body.dark-theme .bg-slate-50 {
            background: #1e293b !important;
        }
        
        body.dark-theme .bg-slate-100 {
            background: #0f172a !important;
        }
        
        body.dark-theme input,
        body.dark-theme select,
        body.dark-theme textarea {
            background: #0f172a !important;
            color: #e2e8f0 !important;
            border-color: #334155 !important;
        }
        
        body.dark-theme .badge {
            background: #1e293b !important;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #2dd4bf;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .material-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .material-card:hover {
            transform: translateX(4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2dd4bf, #14b8a6);
            transition: width 0.3s ease;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #64748b;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .data-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #334155;
        }
        
        .data-table tbody tr:hover {
            background: #f8fafc;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2dd4bf;
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
        }
        
        .btn-primary {
            background: #2dd4bf;
            color: #0f172a;
        }
        
        .btn-primary:hover {
            background: #14b8a6;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(45, 212, 191, 0.3);
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #2dd4bf;
            color: #2dd4bf;
        }
        
        .btn-outline:hover {
            background: #2dd4bf;
            color: #0f172a;
        }
        
        /* Sidebar Toggle */
        #sidebar {
            width: 256px;
            transition: width 0.3s ease, margin-left 0.3s ease;
        }
        
        #sidebar.collapsed {
            width: 80px;
        }
        
        #sidebar.collapsed .nav-link span,
        #sidebar.collapsed .ml-3 {
            display: none;
        }
        
        #sidebar.collapsed .nav-link {
            justify-content: center;
        }
        
        .sidebar-toggle {
            transition: transform 0.3s ease;
        }
        
        #sidebar.collapsed .sidebar-toggle {
            transform: rotate(180deg);
        }
        
        /* Map Container */
        .map-container {
            height: 400px;
            border-radius: 0.75rem;
            overflow: hidden;
            background: #f1f5f9;
            position: relative;
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .location-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .location-marker:hover {
            transform: translate(-50%, -50%) scale(1.3);
        }
    </style>
</head>
<body class="bg-cream antialiased text-gray-800">

    <div id="home-page">
        <header class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-40 transition-all duration-300" id="main-header">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <svg class="h-8 w-auto text-jungle-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75" />
                    </svg>
                    <span class="ml-3 font-black text-xl text-jungle-green tracking-tight">POWERGRID</span>
                </div>
                <div class="hidden md:flex items-center space-x-8" id="home-page-nav">
                    <a href="#features" class="text-gray-600 hover:text-pop-pink font-bold transition-colors">Features</a>
                    <a href="#how-it-works" class="text-gray-600 hover:text-pop-pink font-bold transition-colors">How it works</a>
                    <a href="#solution" class="text-gray-600 hover:text-pop-pink font-bold transition-colors">Solution</a>
                    <a href="#contact" class="text-gray-600 hover:text-pop-pink font-bold transition-colors">Contact</a>
                </div>
                <div class="flex items-center">
                    <button id="home-signin-btn" class="bg-jungle-green text-white py-2.5 px-6 rounded-xl hover:bg-black font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Sign In</button>
                </div>
            </nav>
        </header>

        <main>
            <!-- HERO SECTION -->
            <section id="hero-section" class="relative min-h-screen flex items-center overflow-hidden bg-slate-900">
                <div class="absolute inset-0 bg-gradient-to-br from-slate-900 via-[#0f172a] to-slate-900"></div>
                <div class="absolute top-0 left-0 w-full h-full opacity-20" style="background-image: radial-gradient(#3b82f6 1px, transparent 1px); background-size: 40px 40px;"></div>
                <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-600/20 rounded-full blur-3xl filter mix-blend-screen animate-pulse"></div>
                <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-teal-500/10 rounded-full blur-3xl filter mix-blend-screen"></div>

                <div class="container mx-auto px-6 grid lg:grid-cols-2 gap-12 items-center relative z-10 pt-20 lg:pt-0">
                    <div class="text-center lg:text-left">
                        <div class="inline-flex items-center px-3 py-1 rounded-full border border-blue-500/30 bg-blue-500/10 text-blue-300 text-xs font-medium mb-6">
                            <span class="flex h-2 w-2 rounded-full bg-blue-400 mr-2 animate-pulse"></span>
                            Next-Gen AI Forecasting
                        </div>
                        <h1 class="text-3xl md:text-4xl lg:text-5xl font-extrabold text-white mb-6 leading-tight tracking-tight">
                            Optimize Material Demand with <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-400">Intelligent AI</span>
                        </h1>
                        <p class="text-base text-slate-300 max-w-xl mx-auto lg:mx-0 mb-8 leading-relaxed">
                            Eliminate shortages and reduce overstocking. Our predictive platform analyzes historical data to forecast procurement needs for POWERGRID projects across India.
                        </p>
                        <div class="flex flex-col sm:flex-row justify-center lg:justify-start gap-4">
                            <button id="get-started-btn" class="bg-blue-600 text-white py-3.5 px-8 rounded-full font-semibold hover:bg-blue-500 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">Get Started</button>
                            <button id="learn-more-btn" class="bg-slate-800/50 text-white backdrop-blur-sm border border-white/10 py-3.5 px-8 rounded-full font-semibold hover:bg-white/10 transition-all hover:border-white/30">Learn More</button>
                        </div>
                        <div class="mt-10 pt-8 border-t border-white/5 flex flex-col sm:flex-row items-center justify-center lg:justify-start gap-6 text-slate-400 text-sm">
                            <div class="flex items-center gap-2"><svg class="w-5 h-5 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>98% Forecast Accuracy</span></div>
                            <div class="flex items-center gap-2"><svg class="w-5 h-5 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg><span>Real-time Analytics</span></div>
                        </div>
                    </div>
                    <div class="relative animate-float hidden lg:block">
                         <svg viewBox="0 0 600 450" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto drop-shadow-2xl">
                            <defs>
                                <linearGradient id="cardGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="rgba(30, 41, 59, 0.8)" />
                                    <stop offset="100%" stop-color="rgba(15, 23, 42, 0.9)" />
                                </linearGradient>
                                <linearGradient id="chartGradient" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stop-color="#2dd4bf" stop-opacity="0.5"/>
                                    <stop offset="100%" stop-color="#2dd4bf" stop-opacity="0"/>
                                </linearGradient>
                                <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                                    <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                    <feMerge>
                                        <feMergeNode in="coloredBlur"/>
                                        <feMergeNode in="SourceGraphic"/>
                                    </feMerge>
                                </filter>
                            </defs>
                            <rect x="50" y="50" width="500" height="320" rx="16" fill="url(#cardGradient)" stroke="rgba(255,255,255,0.1)" stroke-width="1" class="glass-panel"/>
                            <circle cx="80" cy="80" r="4" fill="#ef4444" opacity="0.8"/>
                            <circle cx="96" cy="80" r="4" fill="#f59e0b" opacity="0.8"/>
                            <circle cx="112" cy="80" r="4" fill="#22c55e" opacity="0.8"/>
                            <rect x="75" y="110" width="80" height="8" rx="4" fill="rgba(255,255,255,0.1)"/>
                            <rect x="75" y="135" width="60" height="6" rx="3" fill="rgba(255,255,255,0.05)"/>
                            <rect x="75" y="155" width="50" height="6" rx="3" fill="rgba(255,255,255,0.05)"/>
                            <rect x="75" y="175" width="65" height="6" rx="3" fill="rgba(255,255,255,0.05)"/>
                            <line x1="180" y1="110" x2="180" y2="330" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                            <line x1="210" y1="300" x2="520" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                            <line x1="210" y1="250" x2="520" y2="250" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                            <line x1="210" y1="200" x2="520" y2="200" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                            <path d="M210 280 Q 260 270, 310 220 T 410 200 T 520 160 V 300 H 210 Z" fill="url(#chartGradient)" opacity="0.3"/>
                            <path d="M210 280 Q 260 270, 310 220 T 410 200 T 520 160" stroke="#2dd4bf" stroke-width="3" fill="none" stroke-linecap="round" filter="url(#glow)"/>
                            <circle cx="310" cy="220" r="4" fill="#1e293b" stroke="#2dd4bf" stroke-width="2"/>
                            <circle cx="410" cy="200" r="4" fill="#1e293b" stroke="#2dd4bf" stroke-width="2"/>
                            <circle cx="520" cy="160" r="4" fill="#1e293b" stroke="#2dd4bf" stroke-width="2"/>
                            <g transform="translate(420, 90)">
                                <rect width="140" height="60" rx="8" fill="rgba(30, 41, 59, 0.9)" stroke="rgba(45, 212, 191, 0.3)" stroke-width="1" class="glass-panel"/>
                                <circle cx="30" cy="30" r="12" fill="rgba(45, 212, 191, 0.2)"/>
                                <path d="M24 30 L28 34 L36 26" stroke="#2dd4bf" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <text x="50" y="25" fill="#94a3b8" font-size="10" font-family="sans-serif">Efficiency</text>
                                <text x="50" y="42" fill="white" font-size="14" font-family="sans-serif" font-weight="bold">+24.5%</text>
                            </g>
                            <g transform="translate(20, 280)">
                                <rect width="130" height="50" rx="8" fill="rgba(30, 41, 59, 0.9)" stroke="rgba(255,255,255,0.1)" stroke-width="1" class="glass-panel"/>
                                <circle cx="25" cy="25" r="8" fill="#3b82f6"/>
                                <rect x="45" y="18" width="60" height="6" rx="3" fill="rgba(255,255,255,0.8)"/>
                                <rect x="45" y="30" width="40" height="4" rx="2" fill="rgba(255,255,255,0.3)"/>
                            </g>
                        </svg>
                    </div>
                </div>
            </section>

            <!-- 1. Challenges Section -->
            <section id="challenges" class="py-32 bg-cream relative overflow-hidden">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-20 reveal-on-scroll">
                        <span class="text-sm font-black uppercase text-pop-pink tracking-widest mb-4 block">Challenges</span>
                        <h2 class="text-5xl md:text-7xl font-black text-jungle-green mt-2 uppercase leading-none">The Complexity<br>of Scale</h2>
                        <p class="text-gray-500 mt-8 text-lg max-w-2xl mx-auto font-medium">
                            POWERGRID executes numerous national projects. We help you manage variables like budgets, locations, and taxes to prevent cost overruns.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 text-center max-w-7xl mx-auto">
                        <div class="reveal-on-scroll group bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 cursor-pointer border border-transparent hover:border-lime-accent">
                            <div class="bg-lime-accent/30 text-jungle-green rounded-2xl p-4 mb-4 inline-block group-hover:scale-110 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                            </div>
                            <p class="font-bold text-jungle-green text-lg">Budgets</p>
                        </div>
                         <div class="reveal-on-scroll group bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 cursor-pointer border border-transparent hover:border-lime-accent" style="transition-delay: 200ms;">
                            <div class="bg-lime-accent/30 text-jungle-green rounded-2xl p-4 mb-4 inline-block group-hover:scale-110 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            </div>
                            <p class="font-bold text-jungle-green text-lg">Locations</p>
                        </div>
                         <div class="reveal-on-scroll group bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 cursor-pointer border border-transparent hover:border-lime-accent" style="transition-delay: 400ms;">
                            <div class="bg-lime-accent/30 text-jungle-green rounded-2xl p-4 mb-4 inline-block group-hover:scale-110 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 2 7 10H5Z"></path><path d="m12 22 7-10H5Z"></path></svg>
                            </div>
                            <p class="font-bold text-jungle-green text-lg">Tower Types</p>
                        </div>
                         <div class="reveal-on-scroll group bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 cursor-pointer border border-transparent hover:border-lime-accent" style="transition-delay: 600ms;">
                            <div class="bg-lime-accent/30 text-jungle-green rounded-2xl p-4 mb-4 inline-block group-hover:scale-110 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="14" width="18" height="7" rx="2" ry="2"></rect><line x1="6" y1="14" x2="6" y2="11"></line><line x1="18" y1="14" x2="18" y2="11"></line><path d="M6 11h.01"></path><path d="M18 11h.01"></path><path d="M12 11h.01"></path><path d="M4 11h16"></path><path d="M12 14v-3"></path></svg>
                            </div>
                            <p class="font-bold text-jungle-green text-lg">Sub-stations</p>
                        </div>
                        <div class="reveal-on-scroll group bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 cursor-pointer border border-transparent hover:border-lime-accent" style="transition-delay: 800ms;">
                            <div class="bg-lime-accent/30 text-jungle-green rounded-2xl p-4 mb-4 inline-block group-hover:scale-110 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4s1.7-1 2-4c0-2.2-2.3-3.5-5-5-1.3-1-2-1.3-3-1.3-1 0-1.7.3-3 1 .3-1.7 1.5-3 3-3z"></path></svg>
                            </div>
                            <p class="font-bold text-jungle-green text-lg">Taxes</p>
                        </div>
                         <div class="reveal-on-scroll group bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 cursor-pointer border border-transparent hover:border-lime-accent" style="transition-delay: 1000ms;">
                            <div class="bg-lime-accent/30 text-jungle-green rounded-2xl p-4 mb-4 inline-block group-hover:scale-110 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            </div>
                            <p class="font-bold text-jungle-green text-lg">Geography</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Features Section -->
            <section id="features" class="py-32 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-20 reveal-on-scroll">
                         <span class="text-sm font-black uppercase text-pop-pink tracking-widest mb-4 block">Platform Features</span>
                        <h2 class="text-5xl md:text-6xl font-black text-jungle-green mt-2 uppercase leading-none">Everything You Need<br>To Forecast</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <!-- Feature 1 -->
                        <div class="reveal-on-scroll bg-[#F5F5F0] p-10 rounded-[2.5rem] shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-4 border border-gray-200">
                            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mb-8 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#064E3B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-jungle-green mb-4">Accurate Forecasting</h3>
                            <p class="text-gray-500 font-medium leading-relaxed">Leverage AI to predict material needs with high accuracy based on project variables.</p>
                        </div>
                        <!-- Feature 2 -->
                        <div class="reveal-on-scroll bg-[#F5F5F0] p-10 rounded-[2.5rem] shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-4 border border-gray-200" style="transition-delay: 200ms;">
                            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mb-8 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#064E3B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-jungle-green mb-4">Inventory Control</h3>
                            <p class="text-gray-500 font-medium leading-relaxed">Maintain optimal stock levels, automate reorder points, and prevent costly shortages.</p>
                        </div>
                        <!-- Feature 3 -->
                        <div class="reveal-on-scroll bg-[#F5F5F0] p-10 rounded-[2.5rem] shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-4 border border-gray-200" style="transition-delay: 400ms;">
                            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mb-8 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#064E3B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20V16"></path></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-jungle-green mb-4">Real-Time Dashboards</h3>
                            <p class="text-gray-500 font-medium leading-relaxed">Access dynamic visualizations and reports for informed, data-driven decision-making.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. How it Works Section -->
            <section id="how-it-works" class="py-32 bg-jungle-green text-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-24 reveal-on-scroll">
                        <span class="text-sm font-black uppercase text-lime-accent tracking-widest mb-4 block">Our Process</span>
                        <h2 class="text-5xl md:text-6xl font-black mt-2 uppercase leading-none">Four Steps<br>To Efficiency</h2>
                    </div>
                     <div class="max-w-4xl mx-auto">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Step 1 -->
                            <div class="reveal-on-scroll bg-white/5 p-8 rounded-3xl backdrop-blur-sm border border-white/10 hover:bg-white/10 transition-all duration-300">
                                <div class="flex items-center mb-4">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-lime-accent text-jungle-green text-xl font-black mr-4">1</div>
                                    <h3 class="text-2xl font-bold">Input Data</h3>
                                </div>
                                <p class="text-gray-300 font-medium">Securely upload your project details including budget, locations, and material specifications.</p>
                            </div>
                            <!-- Step 2 -->
                            <div class="reveal-on-scroll bg-white/5 p-8 rounded-3xl backdrop-blur-sm border border-white/10 hover:bg-white/10 transition-all duration-300" style="transition-delay: 200ms;">
                                <div class="flex items-center mb-4">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-lime-accent text-jungle-green text-xl font-black mr-4">2</div>
                                    <h3 class="text-2xl font-bold">AI Analysis</h3>
                                </div>
                                <p class="text-gray-300 font-medium">Our intelligent model analyzes the data, identifying patterns and forecasting future needs.</p>
                            </div>
                            <!-- Step 3 -->
                            <div class="reveal-on-scroll bg-white/5 p-8 rounded-3xl backdrop-blur-sm border border-white/10 hover:bg-white/10 transition-all duration-300" style="transition-delay: 400ms;">
                                <div class="flex items-center mb-4">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-lime-accent text-jungle-green text-xl font-black mr-4">3</div>
                                    <h3 class="text-2xl font-bold">Get Forecast</h3>
                                </div>
                                <p class="text-gray-300 font-medium">Receive a detailed breakdown of required materials and smart procurement suggestions.</p>
                            </div>
                             <!-- Step 4 -->
                             <div class="reveal-on-scroll bg-white/5 p-8 rounded-3xl backdrop-blur-sm border border-white/10 hover:bg-white/10 transition-all duration-300" style="transition-delay: 600ms;">
                                <div class="flex items-center mb-4">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-lime-accent text-jungle-green text-xl font-black mr-4">4</div>
                                    <h3 class="text-2xl font-bold">Optimize</h3>
                                </div>
                                <p class="text-gray-300 font-medium">Track your inventory in real-time and continuously optimize your supply chain.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. Solution Section -->
            <section id="solution" class="py-32 bg-cream">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-20 reveal-on-scroll">
                        <span class="text-sm font-black uppercase text-pop-pink tracking-widest mb-4 block">The Solution</span>
                        <h2 class="text-5xl md:text-6xl font-black text-jungle-green mt-2 uppercase leading-none">Unlock Tangible<br>Business Value</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Card 1 -->
                        <div class="reveal-on-scroll bg-white p-8 rounded-3xl shadow-card hover:-translate-y-2 transition-transform duration-300">
                             <div class="flex justify-start items-center mb-6 h-14 w-14 rounded-2xl bg-lime-accent/40 text-jungle-green">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-jungle-green mb-2">Minimize Costs</h3>
                            <p class="text-gray-500 font-medium">Prevent over-stocking and leverage bulk purchasing insights.</p>
                        </div>
                        <!-- Card 2 -->
                        <div class="reveal-on-scroll bg-white p-8 rounded-3xl shadow-card hover:-translate-y-2 transition-transform duration-300" style="transition-delay: 200ms;">
                            <div class="flex justify-start items-center mb-6 h-14 w-14 rounded-2xl bg-lime-accent/40 text-jungle-green">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-jungle-green mb-2">Avoid Shortages</h3>
                            <p class="text-gray-500 font-medium">Ensure materials are available when needed, eliminating costly delays.</p>
                        </div>
                        <!-- Card 3 -->
                        <div class="reveal-on-scroll bg-white p-8 rounded-3xl shadow-card hover:-translate-y-2 transition-transform duration-300" style="transition-delay: 400ms;">
                            <div class="flex justify-start items-center mb-6 h-14 w-14 rounded-2xl bg-lime-accent/40 text-jungle-green">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"></path><path d="M3.34 19a10 10 0 1 1 17.32 0"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-jungle-green mb-2">Improve Efficiency</h3>
                            <p class="text-gray-500 font-medium">Streamline your supply chain and reduce manual planning efforts.</p>
                        </div>
                        <!-- Card 4 -->
                        <div class="reveal-on-scroll bg-white p-8 rounded-3xl shadow-card hover:-translate-y-2 transition-transform duration-300" style="transition-delay: 600ms;">
                           <div class="flex justify-start items-center mb-6 h-14 w-14 rounded-2xl bg-lime-accent/40 text-jungle-green">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.03 5.39a2.4 2.4 0 0 0-3.46 0l-3.03 3.03a2.4 2.4 0 0 0 0 3.46l3.03 3.03a2.4 2.4 0 0 0 3.46 0l3.03-3.03a2.4 2.4 0 0 0 0-3.46Z"></path><path d="m9.01 15.01 3-3"></path><path d="M2.39 15.03a2.4 2.4 0 0 0 0 3.46l3.03 3.03a2.4 2.4 0 0 0 3.46 0l3.03-3.03a2.4 2.4 0 0 0 0-3.46Z"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-jungle-green mb-2">Enhance Decisions</h3>
                            <p class="text-gray-500 font-medium">Make strategic choices with confidence, backed by reliable data.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5. Contact Section -->
            <section id="contact" class="py-32 bg-white relative">
                <div class="container mx-auto px-6">
                    <div class="grid md:grid-cols-2 gap-12 max-w-6xl mx-auto items-center">
                        <div class="reveal-on-scroll">
                            <span class="text-sm font-black uppercase text-pop-pink tracking-widest mb-4 block">Get in Touch</span>
                            <h2 class="text-5xl font-black text-jungle-green mb-6 leading-none">READY TO OPTIMIZE<br>YOUR PROJECTS?</h2>
                            <p class="text-gray-500 text-lg font-medium mb-8">Contact our team to schedule a demo or learn more about how POWERGRID is transforming material forecasting.</p>
                            
                            <div class="bg-cream p-8 rounded-3xl border border-gray-100">
                                <h3 class="text-xl font-bold text-jungle-green mb-6">Contact Information</h3>
                                <div class="space-y-6">
                                    <div class="flex items-start space-x-4">
                                        <div class="flex-shrink-0 bg-white p-3 rounded-xl shadow-sm text-jungle-green">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                        </div>
                                        <div>
                                            <p class="font-bold text-jungle-green">Headquarters</p>
                                            <p class="text-gray-500 mt-1 font-medium text-sm">POWERGRID Corporation of India Ltd.<br>Gurgaon (Haryana) - 122001, INDIA</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start space-x-4">
                                        <div class="flex-shrink-0 bg-white p-3 rounded-xl shadow-sm text-jungle-green">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                        </div>
                                        <div>
                                            <p class="font-bold text-jungle-green">Email Us</p>
                                            <p class="text-gray-500 mt-1 font-medium text-sm">support@powergrid.in</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <form class="bg-jungle-green p-10 rounded-[2.5rem] shadow-2xl reveal-on-scroll">
                            <div class="grid grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-sm font-bold text-lime-accent mb-2 uppercase tracking-wider">First Name</label>
                                    <input type="text" class="w-full px-4 py-4 rounded-xl bg-white/10 border border-white/10 text-white focus:border-lime-accent focus:ring-0 outline-none transition font-medium placeholder-white/30" placeholder="John">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-lime-accent mb-2 uppercase tracking-wider">Last Name</label>
                                    <input type="text" class="w-full px-4 py-4 rounded-xl bg-white/10 border border-white/10 text-white focus:border-lime-accent focus:ring-0 outline-none transition font-medium placeholder-white/30" placeholder="Doe">
                                </div>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-lime-accent mb-2 uppercase tracking-wider">Work Email</label>
                                <input type="email" class="w-full px-4 py-4 rounded-xl bg-white/10 border border-white/10 text-white focus:border-lime-accent focus:ring-0 outline-none transition font-medium placeholder-white/30" placeholder="john@company.com">
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-lime-accent mb-2 uppercase tracking-wider">Message</label>
                                <textarea rows="4" class="w-full px-4 py-4 rounded-xl bg-white/10 border border-white/10 text-white focus:border-lime-accent focus:ring-0 outline-none transition font-medium placeholder-white/30" placeholder="Tell us about your project needs..."></textarea>
                            </div>
                            <button type="submit" class="w-full bg-pop-pink text-white font-black py-4 rounded-xl hover:bg-white hover:text-pop-pink transition-colors duration-300 text-lg shadow-lg">
                                SEND MESSAGE
                            </button>
                        </form>
                    </div>
                </div>
            </section>  
        </main>

        <footer class="bg-cream border-t border-gray-200 text-jungle-green">
            <div class="container mx-auto px-6 py-12">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-6 md:mb-0">
                        <h3 class="font-black text-2xl">POWERGRID</h3>
                        <p class="text-gray-500 mt-2 text-sm font-medium">AI-Powered Material Demand Forecasting</p>
                    </div>
                    <div class="text-gray-400 text-sm font-medium">
                        <p>&copy; 2025 POWERGRID Corporation of India Ltd.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Login Page (Modified for Real Firebase Auth) -->
    <div id="login-page" class="hidden flex items-center justify-center min-h-screen bg-slate-900">
        <div class="w-full max-w-md p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl text-center border border-slate-700 relative">
            <button id="close-login-btn" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <div class="flex justify-center">
                 <svg class="h-10 w-auto text-teal-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75" />
                </svg>
            </div>
            <h2 class="text-3xl font-bold text-white">POWERGRID</h2>
            
            <!-- Auth Tabs (Fixed Visibility with Classes) -->
            <div class="flex justify-center gap-8 border-b border-slate-700 pb-1" id="auth-tabs">
                <button class="auth-tab active pb-2 border-b-2 border-teal-400 text-teal-400 font-medium transition-colors" data-tab="signin">Sign In</button>
                <button class="auth-tab pb-2 border-b-2 border-transparent text-slate-400 hover:text-white font-medium transition-colors" data-tab="signup">Create Account</button>
            </div>

            <!-- Sign In Form -->
            <form id="login-form" class="mt-6 space-y-6">
                <div>
                    <label for="login-email" class="sr-only">Email Address</label>
                    <input id="login-email" name="email" type="email" required class="relative block w-full px-4 py-3 bg-slate-700 border border-slate-600 placeholder-slate-400 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400 sm:text-sm" placeholder="Email Address">
                </div>
                <div>
                    <label for="login-password" class="sr-only">Password</label>
                    <input id="login-password" name="password" type="password" required class="relative block w-full px-4 py-3 bg-slate-700 border border-slate-600 placeholder-slate-400 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400 sm:text-sm" placeholder="Password">
                </div>
                <div class="flex justify-end">
                    <button type="button" id="forgot-password-link" class="text-xs text-teal-400 hover:text-teal-300">Forgot Password?</button>
                </div>
                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-md text-slate-900 bg-teal-400 hover:bg-teal-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-teal-500 transition-colors duration-300">
                    Sign In
                </button>
                <p class="text-sm text-slate-400 mt-4">
                    Don't have an account? <button type="button" id="switch-to-signup" class="text-teal-400 hover:underline font-medium">Create one</button>
                </p>
            </form>

            <!-- Sign Up Form (Hidden by default) -->
            <form id="signup-form" class="mt-6 space-y-6 hidden">
                <div>
                    <label for="signup-email" class="sr-only">Email Address</label>
                    <input id="signup-email" name="email" type="email" required class="relative block w-full px-4 py-3 bg-slate-700 border border-slate-600 placeholder-slate-400 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400 sm:text-sm" placeholder="Email Address">
                </div>
                <div>
                    <label for="signup-password" class="sr-only">Password</label>
                    <input id="signup-password" name="password" type="password" required minlength="6" class="relative block w-full px-4 py-3 bg-slate-700 border border-slate-600 placeholder-slate-400 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400 sm:text-sm" placeholder="Create Password (min 6 chars)">
                </div>
                <div>
                    <label for="signup-confirm-password" class="sr-only">Confirm Password</label>
                    <input id="signup-confirm-password" name="confirm-password" type="password" required class="relative block w-full px-4 py-3 bg-slate-700 border border-slate-600 placeholder-slate-400 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400 sm:text-sm" placeholder="Confirm Password">
                </div>
                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-md text-slate-900 bg-teal-400 hover:bg-teal-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-teal-500 transition-colors duration-300">
                    Create Account
                </button>
                <p class="text-sm text-slate-400 mt-4">
                    Already have an account? <button type="button" id="switch-to-signin" class="text-teal-400 hover:underline font-medium">Sign in</button>
                </p>
            </form>
        </div>
    </div>

    <!-- App Logic (Dashboard) Remains Unchanged -->
    <div id="app" class="hidden">
        <!-- App content preserved from your provided code -->
         <div class="flex h-screen bg-slate-100">
            <div id="sidebar" class="sidebar sidebar-open bg-slate-800 text-slate-300 flex flex-col">
                 <div class="flex items-center justify-between p-4 h-16 border-b border-slate-700">
                    <div class="flex items-center">
                         <svg class="h-8 w-auto text-teal-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75" />
                        </svg>
                        <span class="ml-3 font-semibold text-xl text-white">POWERGRID</span>
                    </div>
                </div>
                <!-- Sidebar content -->
                 <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
                    <a href="#" class="nav-link active flex items-center p-3 text-base font-medium rounded-lg" data-page="dashboard">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        <span class="ml-3">Dashboard</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="forecast">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        <span class="ml-3">Demand Forecast</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="inventory">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                        <span class="ml-3">Inventory</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="projects">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        <span class="ml-3">Projects</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="analytics">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span class="ml-3">Analytics</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="procurement">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span class="ml-3">Procurement</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="reports">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="ml-3">Reports</span>
                    </a>
                    <a href="#" class="nav-link flex items-center p-3 text-base font-medium rounded-lg" data-page="settings">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span class="ml-3">Settings</span>
                    </a>
                    <div class="border-t border-slate-700 my-2"></div>
                     <button id="logout-button" class="w-full text-left flex items-center p-3 text-base font-medium rounded-lg hover:bg-slate-700 text-red-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                        <span class="ml-3">Logout</span>
                     </button>
                </nav>
            </div>
            <div class="flex-1 flex flex-col overflow-hidden">
                 <header class="flex justify-between items-center px-6 h-16 bg-white border-b border-slate-200">
                    <div class="flex items-center gap-4">
                        <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-slate-100 transition-colors sidebar-toggle">
                            <svg class="w-6 h-6 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <h1 id="page-title" class="text-xl font-semibold text-slate-800">Dashboard Overview</h1>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="text-sm text-slate-500 flex items-center space-x-2">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z" clip-rule="evenodd" />
                            </svg>
                            <span id="last-updated">Loading...</span>
                        </div>
                    </div>
                </header>
                 <main id="main-content" class="flex-1 overflow-x-hidden overflow-y-auto bg-slate-100 p-8"></main>
            </div>
         </div>
    </div>
    
    <div id="loading-overlay" class="fixed inset-0 bg-slate-900 bg-opacity-75 z-50 flex items-center justify-center hidden">
        <div class="loading-spinner"></div>
    </div>

    <!-- Generic Modal -->
    <div id="modal-overlay" class="fixed inset-0 bg-slate-900 bg-opacity-75 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4">
            <div class="flex justify-between items-center p-6 border-b border-slate-200">
                <h2 id="modal-title" class="text-2xl font-bold text-slate-800">Modal Title</h2>
                <button id="modal-close" class="text-slate-500 hover:text-slate-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        const BACKEND_URL = "http://127.0.0.1:8000";
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';

        // --- FIREBASE CONFIGURATION ---
        // TODO: 1. Go to Firebase Console > Project Settings.
        // TODO: 2. Scroll down to "Your apps" and copy the "firebaseConfig" object.
        // TODO: 3. Paste it below to replace the placeholders.
        
        const firebaseConfig = {
            apiKey: "AIzaSyBlBoR3z2vc-cnox7n3gsZYfiUY3jnUM2g",
            authDomain: "powergrid-f6fb7.firebaseapp.com",
            projectId: "powergrid-f6fb7",
            storageBucket: "powergrid-f6fb7.firebasestorage.app",
            messagingSenderId: "276511323418",
            appId: "1:276511323418:web:852ea3fbb40e7bbd9228a3",
            measurementId: "G-F48PGP6Q8P"
        };

        // (Internal logic: Uses environment config if running in preview, otherwise uses your config above)
        if (typeof __firebase_config !== 'undefined') {
             try { Object.assign(firebaseConfig, JSON.parse(__firebase_config)); } catch (e) {}
        }

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Mock API for Data (Dashboard logic kept mock for now)
        // Global state for projects
        let projectsData = [
            { id: 'PRJ001', name: '765kV Transmission Line - Mumbai-Pune', region: 'West', location: 'Maharashtra', budget: 12500000, status: 'In Progress', completion: 65, towerType: 'Type A - 765kV', substationType: '765kV GIS', towerCount: 150, lineLength: 280, startDate: '2024-03-15', endDate: '2026-06-30', towerLocations: [{lat: 19.0760, lng: 72.8777}, {lat: 18.5204, lng: 73.8567}], substationLocations: [{lat: 19.0760, lng: 72.8777}, {lat: 18.5204, lng: 73.8567}] },
            { id: 'PRJ002', name: '400kV Substation - Delhi NCR', region: 'North', location: 'Delhi NCR', budget: 8900000, status: 'In Progress', completion: 42, towerType: 'Type B - 400kV', substationType: '400kV AIS', towerCount: 85, lineLength: 120, startDate: '2024-06-01', endDate: '2025-12-31', towerLocations: [{lat: 28.7041, lng: 77.1025}], substationLocations: [{lat: 28.7041, lng: 77.1025}] },
            { id: 'PRJ003', name: '220kV Grid Extension - Bangalore', region: 'South', location: 'Karnataka', budget: 6700000, status: 'Planning', completion: 15, towerType: 'Type C - 220kV', substationType: '220kV Hybrid', towerCount: 95, lineLength: 185, startDate: '2025-01-10', endDate: '2026-08-20', towerLocations: [{lat: 12.9716, lng: 77.5946}], substationLocations: [{lat: 12.9716, lng: 77.5946}] },
            { id: 'PRJ004', name: '765kV HVDC Link - Chennai-Hyderabad', region: 'South', location: 'Tamil Nadu', budget: 15300000, status: 'In Progress', completion: 78, towerType: 'Type A - 765kV', substationType: '765kV GIS', towerCount: 220, lineLength: 625, startDate: '2023-09-01', endDate: '2025-11-30', towerLocations: [{lat: 13.0827, lng: 80.2707}, {lat: 17.3850, lng: 78.4867}], substationLocations: [{lat: 13.0827, lng: 80.2707}, {lat: 17.3850, lng: 78.4867}] }
        ];
        
        // ==========================================
        //  REAL BACKEND CONNECTION (Replaces Mock)
        // ==========================================
        
        const api = {
            // 1. Get Dashboard Stats (Real Calculation)
            getDashboardStats: async () => {
                try {
                    // Fetch all projects and materials to calculate stats
                    // Defaulting to user 1 if not logged in, just for display safety
                    const userId = localStorage.getItem('user_id') || 1;
                    
                    const pRes = await fetch(`${BACKEND_URL}/projects/user/${userId}`); 
                    const mRes = await fetch(`${BACKEND_URL}/materials/list`);
                    
                    const projects = await pRes.json();
                    const materials = await mRes.json();

                    const activeProjects = Array.isArray(projects) ? projects.length : 0; 
                    const totalMaterials = Array.isArray(materials) ? materials.length : 0;
                    
                    // Calculate totals safely
                    let totalSpend = 0;
                    if(Array.isArray(projects)) {
                        totalSpend = projects.reduce((sum, p) => sum + (p.project_budget || 0), 0);
                    }

                    return { 
                        totalProjects: activeProjects,
                        activeProjects: activeProjects,
                        totalMaterials: totalMaterials, 
                        lowStockItems: 0, // Placeholder logic
                        pendingOrders: 0,
                        monthlySpend: totalSpend,
                        forecastAccuracy: 85.5, // Placeholder for AI model result
                        systemStatus: 'Online', 
                        lastUpdated: new Date().toLocaleString('en-IN')
                    };
                } catch (error) {
                    console.error("Dashboard Load Error:", error);
                    return { totalProjects: 0, activeProjects: 0, totalMaterials: 0, monthlySpend: 0, lastUpdated: 'Error' };
                }
            },

            // 2. Create Project (Connects to /projects/create)
            createProject: async (projectData) => {
                // The form submission listener in your HTML handles the actual fetch call
                console.log("Create Project called via API wrapper");
            },

            // 3. Get Projects Summary (Connects to /projects/user/{id})
            getProjectsSummary: async () => {
                try {
                    const userId = localStorage.getItem('user_id') || 1; 
                    const res = await fetch(`${BACKEND_URL}/projects/user/${userId}`);
                    const data = await res.json();
                    
                    if (!Array.isArray(data)) return [];

                    // Map Backend Data to Frontend Format
                    return data.map(p => ({
                        id: p.id,
                        name: p.project_name,
                        location: p.location,
                        region: p.category, // Mapping category to region
                        budget: p.project_budget,
                        status: 'In Progress', // Default status
                        completion: 50, // Default completion
                        towerCount: p.tower_type ? 100 : 0, // Placeholder
                        lineLength: 0,
                        startDate: p.created_at ? p.created_at.split('T')[0] : '2025-01-01',
                        endDate: '2025-12-31',
                        towerType: p.tower_type,
                        substationType: p.terrain // Mapping terrain to substation type for now
                    }));
                } catch (error) {
                    console.error("Error fetching projects:", error);
                    return [];
                }
            },

            // 4. Get Project by ID
            getProjectById: async (id) => {
                // Since we don't have a direct /project/{id} endpoint yet, we filter the list
                const projects = await api.getProjectsSummary();
                return projects.find(p => p.id == id);
            },

            // 5. Get Materials (Connects to /materials/list)
            getMaterialsSummary: async () => {
                try {
                    const res = await fetch(`${BACKEND_URL}/materials/list`);
                    const data = await res.json();
                    
                    if (!Array.isArray(data)) return [];

                    return data.map(m => ({
                        id: m.id,
                        name: m.material_name,
                        category: 'General',
                        currentStock: m.quantity,
                        reorderLevel: 10,
                        status: m.quantity < 10 ? 'Critical' : 'Good',
                        unit: 'Units',
                        cost: m.cost,
                        project_id: m.project_id
                    }));
                } catch (error) {
                    console.error("Error fetching materials:", error);
                    return [];
                }
            },

            // 6. Generate Forecast (Connects to /predict/{id})
            generateForecast: async (formData) => {
                // Currently keeping this as a simulation until you give me the 'prediction_routes.py' logic to connect
                // This ensures the button doesn't crash the app right now.
                
                await new Promise(resolve => setTimeout(resolve, 1500)); // Fake delay
                
                const subtotal = formData.budget * 0.4; // Fake logic
                const taxes = subtotal * 0.18;
                
                return {
                    materials: [
                        { name: 'Steel Towers', quantity: 120, unit: 'Units', costPerUnit: 85000, totalCost: 10200000 },
                        { name: 'Conductors', quantity: 25000, unit: 'Meters', costPerUnit: 450, totalCost: 11250000 }
                    ],
                    costs: { subtotal, taxes, total: subtotal + taxes },
                    chartData: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        historicalData: [10, 15, 12, 20, 18, 25],
                        forecastedData: [28, 32, 40, 45, 50, 55]
                    },
                    confidence: 92.5,
                    recommendations: ['Order steel early', 'Check inventory for conductors']
                };
            },
            
            getProcurementOrders: async () => {
                return []; // Return empty for now as we haven't built this table yet
            }
        };

        // --- Scroll Animation Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Scroll Reveal Observer
            const revealElements = document.querySelectorAll('.reveal-on-scroll');
            
            const revealObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    } else {
                        entry.target.classList.remove('is-visible');
                    }
                });
            }, { threshold: 0.15 });

            revealElements.forEach(el => revealObserver.observe(el));

            const heroSection = document.getElementById('hero-section');
            const mainHeader = document.getElementById('main-header');

            window.addEventListener('scroll', () => {
                if (!heroSection) return;

                const heroBottom = heroSection.getBoundingClientRect().bottom;
                
                // Show badge when hero scrolls out of view
                if (heroBottom < 0) {
                    mainHeader.classList.add('shadow-md', 'bg-white/95');
                } else {
                    mainHeader.classList.remove('shadow-md', 'bg-white/95');
                }
            });
            
            // --- Application Logic ---
            const appEl = document.getElementById('app');
            const loginPage = document.getElementById('login-page');
            const homePage = document.getElementById('home-page');
            
            // Auth Forms
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const authTabs = document.querySelectorAll('.auth-tab');
            
            // Buttons
            const homeSigninBtn = document.getElementById('home-signin-btn');
            const getStartedBtn = document.getElementById('get-started-btn');
            const learnMoreBtn = document.getElementById('learn-more-btn');
            const logoutButtons = document.querySelectorAll('#logout-button'); // Use class or all if ID duplicated
            const closeLoginBtn = document.getElementById('close-login-btn');
            const forgotPasswordLink = document.getElementById('forgot-password-link');
            const switchToSignupBtn = document.getElementById('switch-to-signup');
            const switchToSigninBtn = document.getElementById('switch-to-signin');

            const mainContent = document.getElementById('main-content');
            const pageTitle = document.getElementById('page-title');
            const loadingOverlay = document.getElementById('loading-overlay');
            
            // --- Auth State Listener ---
            // Replace Firebase Auth listener with backend session check
if (localStorage.getItem("user_id")) {
    // User exists  show dashboard
    homePage.classList.add('hidden');
    loginPage.classList.add('hidden');
    loginPage.classList.remove('flex');
    appEl.classList.remove('hidden');

    const savedTheme = localStorage.getItem('dashboardTheme') || 'light';
    applyTheme(savedTheme);

    if(pageTitle) pageTitle.textContent = "Dashboard Overview";
    if(mainContent) renderDashboard();

} else {
    // Not logged in  show home
    appEl.classList.add('hidden');
    loginPage.classList.add('hidden');
    loginPage.classList.remove('flex');
    homePage.classList.remove('hidden');
}


            // --- Event Listeners ---

            // Tab Switching Helper
            function activateTab(tabName) {
                authTabs.forEach(t => {
                    if (t.dataset.tab === tabName) {
                        t.classList.add('active', 'text-teal-400', 'border-teal-400');
                        t.classList.remove('text-slate-400', 'border-transparent');
                    } else {
                        t.classList.remove('active', 'text-teal-400', 'border-teal-400');
                        t.classList.add('text-slate-400', 'border-transparent');
                    }
                });

                if (tabName === 'signin') {
                    loginForm.classList.remove('hidden');
                    signupForm.classList.add('hidden');
                } else {
                    loginForm.classList.add('hidden');
                    signupForm.classList.remove('hidden');
                }
            }

            authTabs.forEach(tab => {
                tab.addEventListener('click', () => activateTab(tab.dataset.tab));
            });

            // Switch Links inside forms
            if (switchToSignupBtn) {
                switchToSignupBtn.addEventListener('click', () => activateTab('signup'));
            }
            if (switchToSigninBtn) {
                switchToSigninBtn.addEventListener('click', () => activateTab('signin'));
            }

            // Navigation Buttons
            const openLogin = () => {
                homePage.classList.add('hidden');
                loginPage.classList.remove('hidden');
                loginPage.classList.add('flex');
            };

            if (homeSigninBtn) homeSigninBtn.addEventListener('click', openLogin);
            if (getStartedBtn) getStartedBtn.addEventListener('click', openLogin);
            
            if (closeLoginBtn) {
                closeLoginBtn.addEventListener('click', () => {
                    loginPage.classList.add('hidden');
                    loginPage.classList.remove('flex');
                    homePage.classList.remove('hidden');
                });
            }

            if (learnMoreBtn) {
                learnMoreBtn.addEventListener('click', () => {
                    document.getElementById('challenges').scrollIntoView({ behavior: 'smooth' });
                });
            }

            // Login Handler
            // ------------------ FASTAPI LOGIN HANDLER ------------------
if (loginForm) {
    loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = e.target['login-email'].value;
    const password = e.target['login-password'].value;

    try {
        const response = await fetch(`${BACKEND_URL}/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (!response.ok) {
            alert("Login failed: " + data.detail);
            return;
        }

        // Store the user ID for later use
        localStorage.setItem("user_id", data.user_id);

        alert("Login successful!");

        // Redirect to dashboard
        homePage.classList.add("hidden");
        loginPage.classList.add("hidden");
        appEl.classList.remove("hidden");

        // Load dashboard
        pageTitle.textContent = "Dashboard Overview";
        renderDashboard();

    } catch (err) {
        alert("Error: Could not connect to server.");
        console.error(err);
    }
});

}


            // Sign Up Handler (Updated: Added Verification)
            // ------------------ FASTAPI SIGNUP HANDLER ------------------
if (signupForm) {
    signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = e.target['signup-email'].value;
    const password = e.target['signup-password'].value;
    const confirm = e.target['signup-confirm-password'].value;

    if (password !== confirm) {
        alert("Passwords do not match!");
        return;
    }

    try {
        const response = await fetch(`${BACKEND_URL}/auth/signup`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        if (!response.ok) {
            const err = await response.json();
            alert("Signup failed: " + err.detail);
            return;
        }

        alert("Signup successful!");
        activateTab("signin");  // Switch to login form

    } catch (err) {
        alert("Error: Could not connect to server.");
        console.error(err);
    }
});

}


            // Forgot Password Handler
            if (forgotPasswordLink) {
                forgotPasswordLink.addEventListener('click', async () => {
                    const email = prompt("Please enter your email address to reset your password:");
                    if (email) {
                        try {
                            await sendPasswordResetEmail(auth, email);
                            // Important Note: Firebase does not send raw passwords. It sends a secure link to reset.
                            alert("A password reset link has been sent to your email.\n\nPlease check your inbox (and spam folder) to set a new password.");
                        } catch (error) {
                            console.error("Reset Error:", error);
                            alert("Failed to send reset email: " + error.message);
                        }
                    }
                });
            }

            // Logout Handler
            document.querySelectorAll('#logout-button').forEach(btn => {
                btn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        appEl.classList.add('hidden');
                        homePage.classList.remove('hidden');
                    } catch (error) {
                        console.error("Logout Error:", error);
                        alert("Failed to logout.");
                    }
                });
            });
            
            // --- Dashboard Page Rendering Functions ---
            
            // Global theme function
            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.body.classList.add('dark-theme');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-theme');
                } else if (theme === 'auto') {
                    // Check system preference
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.body.classList.add('dark-theme');
                    } else {
                        document.body.classList.remove('dark-theme');
                    }
                }
            }
            
            async function renderDashboard() {
                showLoading();
                const stats = await api.getDashboardStats();
                const projects = await api.getProjectsSummary();
                const materials = await api.getMaterialsSummary();
                
                // Update last updated display
                document.getElementById('last-updated').textContent = `Last updated: ${stats.lastUpdated}`;
                
                mainContent.innerHTML = `
                    <div class="fade-in">
                        <!-- Stats Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="stat-card bg-gradient-to-br from-teal-500 to-teal-600 p-6 rounded-xl shadow-lg text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-teal-100 text-sm font-medium">Active Projects</p>
                                        <p class="text-4xl font-bold mt-2">${stats.activeProjects}</p>
                                        <p class="text-xs text-teal-100 mt-2">Out of ${stats.totalProjects} total</p>
                                    </div>
                                    <svg class="w-16 h-16 text-teal-200 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                </div>
                            </div>
                            
                            <div class="stat-card bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-slate-500 text-sm font-medium">Total Materials</p>
                                        <p class="text-4xl font-bold text-slate-800 mt-2">${stats.totalMaterials}</p>
                                        <p class="text-xs text-amber-600 mt-2 font-semibold">${stats.lowStockItems} Low Stock</p>
                                    </div>
                                    <svg class="w-16 h-16 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                                </div>
                            </div>
                            
                            <div class="stat-card bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-slate-500 text-sm font-medium">Pending Orders</p>
                                        <p class="text-4xl font-bold text-slate-800 mt-2">${stats.pendingOrders}</p>
                                        <p class="text-xs text-slate-500 mt-2">Procurement queue</p>
                                    </div>
                                    <svg class="w-16 h-16 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                </div>
                            </div>
                            
                            <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl shadow-lg text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm font-medium">Forecast Accuracy</p>
                                        <p class="text-4xl font-bold mt-2">${stats.forecastAccuracy}%</p>
                                        <p class="text-xs text-blue-100 mt-2">AI Model Performance</p>
                                    </div>
                                    <svg class="w-16 h-16 text-blue-200 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="mb-6">
                            <h2 class="text-xl font-bold text-slate-800 mb-4">Quick Actions</h2>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <button class="quick-action-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-teal-500 hover:shadow-lg transition-all text-left" data-page="forecast">
                                    <svg class="w-8 h-8 text-teal-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                    <p class="font-semibold text-slate-800">Generate Forecast</p>
                                    <p class="text-xs text-slate-500 mt-1">AI-powered predictions</p>
                                </button>
                                
                                <button class="quick-action-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-teal-500 hover:shadow-lg transition-all text-left" data-page="inventory">
                                    <svg class="w-8 h-8 text-blue-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                                    <p class="font-semibold text-slate-800">View Inventory</p>
                                    <p class="text-xs text-slate-500 mt-1">Stock management</p>
                                </button>
                                
                                <button class="quick-action-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-teal-500 hover:shadow-lg transition-all text-left" data-page="procurement">
                                    <svg class="w-8 h-8 text-purple-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                    <p class="font-semibold text-slate-800">New Order</p>
                                    <p class="text-xs text-slate-500 mt-1">Create procurement</p>
                                </button>
                                
                                <button class="quick-action-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-teal-500 hover:shadow-lg transition-all text-left" data-page="reports">
                                    <svg class="w-8 h-8 text-orange-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    <p class="font-semibold text-slate-800">View Reports</p>
                                    <p class="text-xs text-slate-500 mt-1">Analytics & exports</p>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Recent Projects & Materials -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-bold text-slate-800">Active Projects</h3>
                                    <button class="text-teal-500 text-sm font-semibold hover:underline quick-action-btn" data-page="projects">View All</button>
                                </div>
                                <div class="space-y-3">
                                    ${projects.slice(0, 4).map(p => `
                                        <div class="p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <p class="font-semibold text-slate-800 text-sm">${p.name}</p>
                                                <span class="badge badge-info text-xs">${p.status}</span>
                                            </div>
                                            <div class="flex items-center justify-between text-xs text-slate-500 mb-2">
                                                <span>${p.location}</span>
                                                <span>${(p.budget / 100000).toFixed(1)}L</span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${p.completion}%"></div>
                                            </div>
                                            <p class="text-xs text-slate-500 mt-1">${p.completion}% Complete</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-bold text-slate-800">Inventory Alerts</h3>
                                    <button class="text-teal-500 text-sm font-semibold hover:underline quick-action-btn" data-page="inventory">View All</button>
                                </div>
                                <div class="space-y-3">
                                    ${materials.filter(m => m.status !== 'Good').map(m => `
                                        <div class="material-card p-3 bg-slate-50 rounded-lg border-l-4 ${m.status === 'Critical' ? 'border-red-500' : 'border-amber-500'}">
                                            <div class="flex items-center justify-between mb-1">
                                                <p class="font-semibold text-slate-800 text-sm">${m.name}</p>
                                                <span class="badge ${m.status === 'Critical' ? 'badge-danger' : 'badge-warning'} text-xs">${m.status}</span>
                                            </div>
                                            <div class="flex items-center justify-between text-xs text-slate-500">
                                                <span>Stock: ${m.currentStock} ${m.unit}</span>
                                                <span>Reorder: ${m.reorderLevel}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${materials.filter(m => m.status === 'Good').slice(0, 2).map(m => `
                                        <div class="material-card p-3 bg-slate-50 rounded-lg border-l-4 border-green-500">
                                            <div class="flex items-center justify-between mb-1">
                                                <p class="font-semibold text-slate-800 text-sm">${m.name}</p>
                                                <span class="badge badge-success text-xs">${m.status}</span>
                                            </div>
                                            <div class="flex items-center justify-between text-xs text-slate-500">
                                                <span>Stock: ${m.currentStock} ${m.unit}</span>
                                                <span>Reorder: ${m.reorderLevel}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                hideLoading();
                attachQuickActionListeners();
            }
            
            async function renderForecastPage() {
                pageTitle.textContent = "AI Demand Forecast";
                const projects = await api.getProjectsSummary();
                
                mainContent.innerHTML = `
                    <div class="fade-in max-w-6xl">
                        <div class="bg-gradient-to-r from-teal-500 to-blue-500 p-8 rounded-2xl shadow-lg text-white mb-6">
                            <h2 class="text-3xl font-bold mb-2">AI-Powered Material Demand Forecasting</h2>
                            <p class="text-teal-50">Generate accurate predictions for material requirements based on project parameters and historical data</p>
                        </div>
                        
                        <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-slate-800">Project Parameters</h3>
                                <button id="toggle-project-select" class="btn btn-outline text-sm">Select Existing Project</button>
                            </div>
                            
                            <!-- Project Selection Card -->
                            <div id="project-selection-card" class="hidden mb-6 p-6 bg-blue-50 border border-blue-200 rounded-xl">
                                <label class="block text-sm font-semibold text-slate-700 mb-3">Select Project to Auto-Fill</label>
                                <select id="project-selector" class="w-full mb-4">
                                    <option value="">-- Choose a project --</option>
                                    ${projects.map(p => `<option value="${p.id}">${p.id} - ${p.name}</option>`).join('')}
                                </select>
                                <p class="text-xs text-blue-700">Selecting a project will automatically populate all fields below</p>
                            </div>
                            
                            <form id="forecast-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Project Name *</label>
                                        <input type="text" name="projectName" required class="w-full" placeholder="e.g., 765kV Transmission Line">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Region *</label>
                                        <select name="region" id="forecast-region" required class="w-full">
                                            <option value="">Select Region</option>
                                            <option value="North">North India</option>
                                            <option value="South">South India</option>
                                            <option value="East">East India</option>
                                            <option value="West">West India</option>
                                            <option value="Central">Central India</option>
                                            <option value="North East">North East India</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">State *</label>
                                        <select name="location" id="forecast-location" required class="w-full">
                                            <option value="">Select Region First</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Budget ( Crores) *</label>
                                        <input type="number" name="budget" required class="w-full" placeholder="e.g., 100" step="0.01">
                                        <p class="text-xs text-slate-500 mt-1">Enter budget in Crores (e.g., 100 for 100 Crores)</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Start Date *</label>
                                        <input type="date" name="startDate" required class="w-full">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">End Date *</label>
                                        <input type="date" name="endDate" required class="w-full">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Tower Type *</label>
                                        <select name="towerType" required class="w-full">
                                            <option value="">Select Type</option>
                                            <option value="Type A - 765kV">Type A - 765kV</option>
                                            <option value="Type B - 400kV">Type B - 400kV</option>
                                            <option value="Type C - 220kV">Type C - 220kV</option>
                                            <option value="Type D - 132kV">Type D - 132kV</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Substation Type *</label>
                                        <select name="substationType" required class="w-full">
                                            <option value="">Select Type</option>
                                            <option value="765kV GIS">765kV GIS</option>
                                            <option value="400kV AIS">400kV AIS</option>
                                            <option value="220kV Hybrid">220kV Hybrid</option>
                                            <option value="132kV Standard">132kV Standard</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Number of Towers *</label>
                                        <input type="number" name="towerCount" required class="w-full" placeholder="e.g., 150" min="1">
                                    </div>
                                </div>
                                
                                <!-- Map Section for Tower & Substation Locations -->
                                <div class="space-y-4">
                                    <h4 class="text-lg font-bold text-slate-800">Location Planning</h4>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-sm font-semibold text-slate-700 mb-2">Tower Locations (Click on map to add)</label>
                                            <div class="map-container" id="tower-map">
                                                <div class="map-placeholder">
                                                    <div class="text-center">
                                                        <svg class="w-16 h-16 mx-auto mb-2" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                                        </svg>
                                                        <p class="font-semibold">India Map - Tower Locations</p>
                                                        <p class="text-xs mt-1 opacity-80">Click to mark tower positions</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="tower-coords" class="mt-2 text-xs text-slate-600"></div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-slate-700 mb-2">Substation Locations (Click on map to add)</label>
                                            <div class="map-container" id="substation-map">
                                                <div class="map-placeholder">
                                                    <div class="text-center">
                                                        <svg class="w-16 h-16 mx-auto mb-2" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                                        </svg>
                                                        <p class="font-semibold">India Map - Substation Locations</p>
                                                        <p class="text-xs mt-1 opacity-80">Click to mark substation positions</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="substation-coords" class="mt-2 text-xs text-slate-600"></div>
                                        </div>
                                    </div>
                                    <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                        <div class="flex items-start gap-3">
                                            <svg class="w-5 h-5 text-green-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                            <div class="flex-1">
                                                <p class="text-sm font-semibold text-green-800">Calculated Distance</p>
                                                <p id="calculated-distance" class="text-2xl font-bold text-green-700 mt-1">-- km</p>
                                                <p class="text-xs text-green-600 mt-1">Distance automatically calculated between marked locations</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-4 pt-4">
                                    <button type="submit" class="btn btn-primary flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                        Generate AI Forecast
                                    </button>
                                    <button type="reset" class="btn btn-secondary">Reset Form</button>
                                </div>
                            </form>
                        </div>
                        
                        <div id="forecast-results" class="hidden mt-6"></div>
                    </div>
                `;
                
                // Region-to-State mapping
                const regionStates = {
                    'North': ['Delhi NCR', 'Punjab', 'Haryana', 'Himachal Pradesh', 'Jammu & Kashmir', 'Uttarakhand', 'Uttar Pradesh', 'Rajasthan'],
                    'South': ['Karnataka', 'Tamil Nadu', 'Kerala', 'Andhra Pradesh', 'Telangana', 'Puducherry'],
                    'East': ['West Bengal', 'Bihar', 'Odisha', 'Jharkhand'],
                    'West': ['Maharashtra', 'Gujarat', 'Goa'],
                    'Central': ['Madhya Pradesh', 'Chhattisgarh'],
                    'North East': ['Assam', 'Arunachal Pradesh', 'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Tripura', 'Sikkim']
                };
                
                // Forecast form region-state filtering
                const forecastRegion = document.getElementById('forecast-region');
                const forecastLocation = document.getElementById('forecast-location');
                
                forecastRegion.addEventListener('change', (e) => {
                    const selectedRegion = e.target.value;
                    forecastLocation.innerHTML = '<option value="">Select State</option>';
                    
                    if (selectedRegion && regionStates[selectedRegion]) {
                        regionStates[selectedRegion].forEach(state => {
                            const option = document.createElement('option');
                            option.value = state;
                            option.textContent = state;
                            forecastLocation.appendChild(option);
                        });
                    }
                });
                
                // Project selection toggle
                document.getElementById('toggle-project-select').addEventListener('click', () => {
                    const card = document.getElementById('project-selection-card');
                    card.classList.toggle('hidden');
                });
                
                // Project auto-fill functionality
                let towerLocations = [];
                let substationLocations = [];
                
                document.getElementById('project-selector').addEventListener('change', async (e) => {
                    const projectId = e.target.value;
                    if (!projectId) return;
                    
                    const project = await api.getProjectById(projectId);
                    if (project) {
                        const form = document.getElementById('forecast-form');
                        form.projectName.value = project.name;
                        
                        // Auto-fill region and trigger state population
                        if (project.region) {
                            form.region.value = project.region;
                            form.region.dispatchEvent(new Event('change'));
                            setTimeout(() => {
                                form.location.value = project.location;
                            }, 100);
                        }
                        
                        form.budget.value = (project.budget / 10000000).toFixed(2);
                        form.startDate.value = project.startDate;
                        form.endDate.value = project.endDate;
                        form.towerType.value = project.towerType;
                        form.substationType.value = project.substationType;
                        form.towerCount.value = project.towerCount;
                        
                        towerLocations = project.towerLocations || [];
                        substationLocations = project.substationLocations || [];
                        
                        updateMapDisplay();
                        calculateDistance();
                    }
                });
                
                // Map interaction for tower locations
                // NOTE: Ready for Indian Map API integration - replace placeholder with actual map library (e.g., Leaflet, Google Maps)
                // When integrating API: Replace click coordinates with map.on('click') event and use e.latlng for real coordinates
                const towerMap = document.getElementById('tower-map');
                const substationMap = document.getElementById('substation-map');
                
                towerMap.addEventListener('click', (e) => {
                    // Skip if clicking on a marker for removal
                    if (e.target.classList.contains('location-marker')) return;
                    
                    const rect = e.currentTarget.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    
                    // Simulated lat/lng (India bounds: lat 8-37, lng 68-97)
                    // TODO: Replace with actual map API coordinates when integrated
                    const lat = 37 - (y / 100) * 29;
                    const lng = 68 + (x / 100) * 29;
                    
                    towerLocations.push({ lat: parseFloat(lat.toFixed(4)), lng: parseFloat(lng.toFixed(4)), x, y });
                    updateMapDisplay();
                    calculateDistance();
                });
                
                // Map interaction for substation locations
                substationMap.addEventListener('click', (e) => {
                    if (e.target.classList.contains('location-marker')) return;
                    
                    const rect = e.currentTarget.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    
                    // Simulated lat/lng - replace when using real map API
                    const lat = 37 - (y / 100) * 29;
                    const lng = 68 + (x / 100) * 29;
                    
                    substationLocations.push({ lat: parseFloat(lat.toFixed(4)), lng: parseFloat(lng.toFixed(4)), x, y });
                    updateMapDisplay();
                    calculateDistance();
                });
                
                function updateMapDisplay() {
                    // Update tower map
                    const towerMap = document.getElementById('tower-map');
                    const existingTowerMarkers = towerMap.querySelectorAll('.location-marker');
                    existingTowerMarkers.forEach(m => m.remove());
                    
                    towerLocations.forEach((loc, idx) => {
                        const marker = document.createElement('div');
                        marker.className = 'location-marker';
                        marker.style.left = loc.x + '%';
                        marker.style.top = loc.y + '%';
                        marker.title = `Tower ${idx + 1}: ${loc.lat}, ${loc.lng} - Click to remove`;
                        marker.dataset.index = idx;
                        marker.dataset.type = 'tower';
                        marker.addEventListener('click', (e) => {
                            e.stopPropagation();
                            towerLocations.splice(idx, 1);
                            updateMapDisplay();
                            calculateDistance();
                        });
                        towerMap.appendChild(marker);
                    });
                    
                    document.getElementById('tower-coords').textContent = 
                        towerLocations.length > 0 ? `${towerLocations.length} tower location(s) marked (click marker to remove)` : 'No locations marked yet';
                    
                    // Update substation map
                    const substationMap = document.getElementById('substation-map');
                    const existingSubMarkers = substationMap.querySelectorAll('.location-marker');
                    existingSubMarkers.forEach(m => m.remove());
                    
                    substationLocations.forEach((loc, idx) => {
                        const marker = document.createElement('div');
                        marker.className = 'location-marker';
                        marker.style.left = loc.x + '%';
                        marker.style.top = loc.y + '%';
                        marker.style.background = '#3b82f6';
                        marker.title = `Substation ${idx + 1}: ${loc.lat}, ${loc.lng} - Click to remove`;
                        marker.dataset.index = idx;
                        marker.dataset.type = 'substation';
                        marker.addEventListener('click', (e) => {
                            e.stopPropagation();
                            substationLocations.splice(idx, 1);
                            updateMapDisplay();
                            calculateDistance();
                        });
                        substationMap.appendChild(marker);
                    });
                    
                    document.getElementById('substation-coords').textContent = 
                        substationLocations.length > 0 ? `${substationLocations.length} substation location(s) marked (click marker to remove)` : 'No locations marked yet';
                }
                
                function calculateDistance() {
                    if (towerLocations.length < 2 && substationLocations.length < 2) {
                        document.getElementById('calculated-distance').textContent = '-- km';
                        return;
                    }
                    
                    // Haversine formula for distance calculation
                    const haversine = (lat1, lon1, lat2, lon2) => {
                        const R = 6371; // Earth radius in km
                        const dLat = (lat2 - lat1) * Math.PI / 180;
                        const dLon = (lon2 - lon1) * Math.PI / 180;
                        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                                  Math.sin(dLon/2) * Math.sin(dLon/2);
                        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                        return R * c;
                    };
                    
                    let totalDistance = 0;
                    const allLocations = [...towerLocations, ...substationLocations];
                    
                    for (let i = 0; i < allLocations.length - 1; i++) {
                        totalDistance += haversine(
                            allLocations[i].lat, allLocations[i].lng,
                            allLocations[i + 1].lat, allLocations[i + 1].lng
                        );
                    }
                    
                    document.getElementById('calculated-distance').textContent = totalDistance.toFixed(2) + ' km';
                    
                    // Auto-fill line length in form
                    const form = document.getElementById('forecast-form');
                    if (!form.lineLength && totalDistance > 0) {
                        // Create hidden input for line length
                        let lineInput = document.querySelector('input[name="lineLength"]');
                        if (!lineInput) {
                            lineInput = document.createElement('input');
                            lineInput.type = 'hidden';
                            lineInput.name = 'lineLength';
                            form.appendChild(lineInput);
                        }
                        lineInput.value = Math.round(totalDistance);
                    }
                }
                
                // Restore previous forecast if exists
                const savedForecast = sessionStorage.getItem('lastForecastResults');
                if (savedForecast) {
                    const resultsDiv = document.getElementById('forecast-results');
                    resultsDiv.innerHTML = savedForecast;
                    resultsDiv.classList.remove('hidden');
                }
                
                document.getElementById('forecast-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showLoading();
                    
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);
                    
                    // Convert budget from crores to base units
                    data.budget = parseFloat(data.budget) * 10000000;
                    
                    const results = await api.generateForecast(data);
                    
                    const resultsDiv = document.getElementById('forecast-results');
                    const forecastHTML = `
                        <div class="fade-in space-y-6">
                            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <div>
                                        <h3 class="text-lg font-bold text-green-800">Forecast Generated Successfully</h3>
                                        <p class="text-sm text-green-700">AI Model Confidence: ${results.confidence}% | Generated: ${new Date().toLocaleString()}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-xl font-bold text-slate-800 mb-4">Forecasted Material Requirements</h3>
                                <div class="overflow-x-auto">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Material Name</th>
                                                <th>Quantity</th>
                                                <th>Unit</th>
                                                <th>Cost/Unit ()</th>
                                                <th>Total Cost ()</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${results.materials.map(m => `
                                                <tr>
                                                    <td class="font-semibold">${m.name}</td>
                                                    <td>${m.quantity.toLocaleString()}</td>
                                                    <td>${m.unit}</td>
                                                    <td>${m.costPerUnit.toLocaleString()}</td>
                                                    <td class="font-bold">${m.totalCost.toLocaleString()}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                        <tfoot>
                                            <tr class="bg-slate-50 font-bold">
                                                <td colspan="4" class="text-right">Subtotal:</td>
                                                <td>${results.costs.subtotal.toLocaleString()}</td>
                                            </tr>
                                            <tr class="bg-slate-50">
                                                <td colspan="4" class="text-right">Taxes (18% GST):</td>
                                                <td>${results.costs.taxes.toLocaleString()}</td>
                                            </tr>
                                            <tr class="bg-teal-50 font-bold text-lg">
                                                <td colspan="4" class="text-right">Total Estimated Cost:</td>
                                                <td class="text-teal-600">${results.costs.total.toLocaleString()}</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                    <h3 class="text-lg font-bold text-slate-800 mb-4">AI Recommendations</h3>
                                    <ul class="space-y-3">
                                        ${results.recommendations.map(rec => `
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-teal-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                                <span class="text-sm text-slate-700">${rec}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                                
                                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                    <h3 class="text-lg font-bold text-slate-800 mb-4">Demand Trend Analysis</h3>
                                    <canvas id="forecast-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="flex gap-4">
                                <button class="btn btn-primary" onclick="window.print()">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                                    Print Report
                                </button>
                                <button class="btn btn-outline export-excel-btn">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                    Export to Excel
                                </button>
                            </div>
                        </div>
                    `;
                    
                    resultsDiv.innerHTML = forecastHTML;
                    resultsDiv.classList.remove('hidden');
                    
                    // Render Chart
                    const ctx = document.getElementById('forecast-chart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: results.chartData.labels,
                            datasets: [{
                                label: 'Historical Demand',
                                data: results.chartData.historicalData,
                                borderColor: '#64748b',
                                backgroundColor: 'rgba(100, 116, 139, 0.1)',
                                tension: 0.4
                            }, {
                                label: 'Forecasted Demand',
                                data: results.chartData.forecastedData,
                                borderColor: '#2dd4bf',
                                backgroundColor: 'rgba(45, 212, 191, 0.1)',
                                tension: 0.4,
                                borderDash: [5, 5]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: { position: 'bottom' }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                    
                    hideLoading();
                    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                    // Add export functionality
                    const exportBtn = document.querySelector('.export-excel-btn');
                    if (exportBtn) {
                        exportBtn.addEventListener('click', () => {
                            const csvContent = results.materials.map(m => 
                                `${m.name},${m.quantity},${m.unit},${m.costPerUnit},${m.totalCost}`
                            ).join('\n');
                            const blob = new Blob([`Material,Quantity,Unit,Cost/Unit,Total\n${csvContent}`], { type: 'text/csv' });
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `forecast-${Date.now()}.csv`;
                            a.click();
                        });
                    }
                    
                    // Save forecast to sessionStorage for persistence across navigation
                    sessionStorage.setItem('lastForecastResults', resultsDiv.innerHTML);
                });
                
                // Clear forecast when form is reset
                document.getElementById('forecast-form').addEventListener('reset', () => {
                    sessionStorage.removeItem('lastForecastResults');
                    document.getElementById('forecast-results').classList.add('hidden');
                    towerLocations = [];
                    substationLocations = [];
                    updateMapDisplay();
                    calculateDistance();
                });
            }
            
            async function renderInventoryPage() {
                showLoading();
                pageTitle.textContent = "Inventory Management";
                const materials = await fetch(`${BACKEND_URL}/materials/list`)
    .then(res => res.json())
    .catch(() => []);

                
                mainContent.innerHTML = `
    <div class="fade-in">
        <div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Material Inventory</h2>
                <button id="addMaterialBtn" class="btn btn-primary">Add New Material</button>
            </div>

            <table class="data-table w-full">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Project ID</th>
                        <th>Material</th>
                        <th>Quantity</th>
                        <th>Cost</th>
                    </tr>
                </thead>
                <tbody id="materials-table">
                </tbody>
            </table>
        </div>
    </div>
`;
const tableBody = document.getElementById("materials-table");

materials?.forEach(m => {
    const row = `
        <tr>
            <td>${m.id}</td>
            <td>${m.project_id}</td>
            <td>${m.material_name}</td>
            <td>${m.quantity}</td>
            <td>${m.cost}</td>
        </tr>
    `;
    tableBody.insertAdjacentHTML("beforeend", row);
});

                
              document.querySelector(".btn.btn-primary").addEventListener("click", () => {
    document.getElementById("modal-title").textContent = "Add New Material";
    document.getElementById("modal-content").innerHTML = `
        <form id="add-material-form" class="space-y-4">

            <label class="block text-sm font-semibold">Select Project *</label>
            <input type="number" name="project_id" required placeholder="Enter Project ID (ex: 1)" class="w-full">

            <div>
                <label class="block text-sm font-semibold">Material Name *</label>
                <input type="text" name="material_name" required class="w-full">
            </div>

            <div>
                <label class="block text-sm font-semibold">Quantity *</label>
                <input type="number" name="quantity" required class="w-full">
            </div>

            <div>
                <label class="block text-sm font-semibold">Cost *</label>
                <input type="number" name="cost" required class="w-full">
            </div>

            <button type="submit" class="btn btn-primary w-full">Save Material</button>
        </form>
    `;
    document.getElementById("modal-overlay").classList.remove("hidden");
});
// ---- SAVE MATERIAL FORM SUBMIT ---- //
document.addEventListener("submit", async function (e) {
    if (e.target.id === "add-material-form") {
        e.preventDefault();

        const form = new FormData(e.target);

        const materialData = {
            project_id: parseInt(form.get("project_id")),
            material_name: form.get("material_name"),
            quantity: parseInt(form.get("quantity")),
            cost: parseFloat(form.get("cost"))
        };

        try {
            const response = await fetch(`${BACKEND_URL}/materials/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(materialData)
            });

            const result = await response.json();

            if (!response.ok) {
                alert(" Error: " + result.detail);
                return;
            }

            alert(" Material Added Successfully!");
            document.getElementById("modal-overlay").classList.add("hidden");

        } catch (err) {
            alert(" Backend Not Responding");
            console.log(err);
        }
    }
});


            }
            
            async function renderProjectsPage() {
                showLoading();
                pageTitle.textContent = "Project Management";
                const projects = await api.getProjectsSummary();
                
                // Store for filtering
                window.projectsFilterData = projects;
                
                mainContent.innerHTML = `
                    <div class="fade-in">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-slate-800">Active Projects</h2>
                                <button id="create-project-btn" class="btn btn-primary">Create New Project</button>
                            </div>
                            
                            <!-- Project Filters -->
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-6">
                                <h3 class="text-sm font-bold text-slate-700 mb-3">Filter Projects</h3>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-xs font-medium text-slate-600 mb-1">Region</label>
                                        <select id="project-filter-region" class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                            <option value="">All Regions</option>
                                            <option value="North">North</option>
                                            <option value="South">South</option>
                                            <option value="East">East</option>
                                            <option value="West">West</option>
                                            <option value="Central">Central</option>
                                            <option value="North East">North East</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-600 mb-1">Status</label>
                                        <select id="project-filter-status" class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                            <option value="">All Status</option>
                                            <option value="Planning">Planning</option>
                                            <option value="In Progress">In Progress</option>
                                            <option value="Completed">Completed</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-600 mb-1">Min Completion %</label>
                                        <input type="number" id="project-filter-min-completion" min="0" max="100" placeholder="0" class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-600 mb-1">Max Completion %</label>
                                        <input type="number" id="project-filter-max-completion" min="0" max="100" placeholder="100" class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                    </div>
                                    <div class="md:col-span-4">
                                        <button id="reset-project-filters" class="btn btn-outline text-sm">Clear All Filters</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="projects-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                ${projects.map(p => `
                                    <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 hover:shadow-lg transition-all">
                                        <div class="flex items-center justify-between mb-3">
                                            <span class="font-mono text-xs text-slate-500">${p.id}</span>
                                            <span class="badge ${p.status === 'In Progress' ? 'badge-info' : 'badge-warning'}">${p.status}</span>
                                        </div>
                                        <h3 class="text-lg font-bold text-slate-800 mb-2">${p.name}</h3>
                                        <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                                            <div>
                                                <p class="text-slate-500">Region</p>
                                                <p class="font-semibold text-slate-700">${p.region || 'N/A'}</p>
                                            </div>
                                            <div>
                                                <p class="text-slate-500">Location</p>
                                                <p class="font-semibold text-slate-700">${p.location}</p>
                                            </div>
                                            <div>
                                                <p class="text-slate-500">Budget</p>
                                                <p class="font-semibold text-slate-700">${(p.budget / 10000000).toFixed(2)}Cr</p>
                                            </div>
                                            <div>
                                                <p class="text-slate-500">Towers</p>
                                                <p class="font-semibold text-slate-700">${p.towerCount}</p>
                                            </div>
                                            <div>
                                                <p class="text-slate-500">Start Date</p>
                                                <p class="font-semibold text-slate-700">${p.startDate}</p>
                                            </div>
                                            <div>
                                                <p class="text-slate-500">End Date</p>
                                                <p class="font-semibold text-slate-700">${p.endDate}</p>
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <div class="flex items-center justify-between text-sm mb-1">
                                                <span class="text-slate-600">Progress</span>
                                                <span class="font-bold text-teal-600">${p.completion}%</span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${p.completion}%"></div>
                                            </div>
                                        </div>
                                        <div class="flex gap-2 mt-4">
                                            <button class="flex-1 btn btn-outline text-sm use-in-forecast" data-project-id="${p.id}">Use in Forecast</button>
                                            <button class="btn btn-secondary text-sm view-project-details" data-project='${JSON.stringify(p)}'>View Details</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                hideLoading();
                
                // Project filter listeners - auto-apply on change
                document.getElementById('project-filter-region').addEventListener('change', applyProjectFilters);
                document.getElementById('project-filter-status').addEventListener('change', applyProjectFilters);
                document.getElementById('project-filter-min-completion').addEventListener('input', applyProjectFilters);
                document.getElementById('project-filter-max-completion').addEventListener('input', applyProjectFilters);
                
                document.getElementById('reset-project-filters').addEventListener('click', () => {
                    document.getElementById('project-filter-region').value = '';
                    document.getElementById('project-filter-status').value = '';
                    document.getElementById('project-filter-min-completion').value = '';
                    document.getElementById('project-filter-max-completion').value = '';
                    renderProjectGrid(window.projectsFilterData);
                });
                
                // Create Project Modal
                document.getElementById('create-project-btn').addEventListener('click', () => {
                    document.getElementById('modal-title').textContent = 'Create New Project';
                    document.getElementById('modal-content').innerHTML = `
                        <form id="new-project-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Project Name *</label>
                                    <input type="text" name="name" required class="w-full" placeholder="e.g., 400kV Transmission Line">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Region *</label>
                                    <select name="region" id="project-region" required class="w-full">
                                        <option value="">Select Region</option>
                                        <option value="North">North India</option>
                                        <option value="South">South India</option>
                                        <option value="East">East India</option>
                                        <option value="West">West India</option>
                                        <option value="Central">Central India</option>
                                        <option value="North East">North East India</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">State *</label>
                                    <select name="location" id="project-location" required class="w-full">
                                        <option value="">Select Region First</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Budget ( Crores) *</label>
                                    <input type="number" name="budget" required class="w-full" placeholder="100" step="0.01">
                                    <p class="text-xs text-slate-500 mt-1">Enter budget in Crores (e.g., 100 for 100 Crores)</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Tower Type *</label>
                                    <select name="towerType" required class="w-full">
                                        <option value="">Select Type</option>
                                        <option value="Type A - 765kV">Type A - 765kV</option>
                                        <option value="Type B - 400kV">Type B - 400kV</option>
                                        <option value="Type C - 220kV">Type C - 220kV</option>
                                        <option value="Type D - 132kV">Type D - 132kV</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Substation Type *</label>
                                    <select name="substationType" required class="w-full">
                                        <option value="">Select Type</option>
                                        <option value="765kV GIS">765kV GIS</option>
                                        <option value="400kV AIS">400kV AIS</option>
                                        <option value="220kV Hybrid">220kV Hybrid</option>
                                        <option value="132kV Standard">132kV Standard</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Number of Towers *</label>
                                    <input type="number" name="towerCount" required class="w-full" min="1" placeholder="150">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Line Length (km) *</label>
                                    <input type="number" name="lineLength" required class="w-full" min="1" placeholder="250">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Start Date *</label>
                                    <input type="date" name="startDate" required class="w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">End Date *</label>
                                    <input type="date" name="endDate" required class="w-full">
                                </div>
                            </div>
                            <div class="flex gap-4 pt-4">
                                <button type="submit" class="btn btn-primary">Create Project</button>
                                <button type="button" id="cancel-create" class="btn btn-secondary">Cancel</button>
                            </div>
                        </form>
                    `;
                    document.getElementById('modal-overlay').classList.remove('hidden');
                    
                    // Region-to-State mapping
                    const regionStates = {
                        'North': ['Delhi NCR', 'Punjab', 'Haryana', 'Himachal Pradesh', 'Jammu & Kashmir', 'Uttarakhand', 'Uttar Pradesh', 'Rajasthan'],
                        'South': ['Karnataka', 'Tamil Nadu', 'Kerala', 'Andhra Pradesh', 'Telangana', 'Puducherry'],
                        'East': ['West Bengal', 'Bihar', 'Odisha', 'Jharkhand'],
                        'West': ['Maharashtra', 'Gujarat', 'Goa'],
                        'Central': ['Madhya Pradesh', 'Chhattisgarh'],
                        'North East': ['Assam', 'Arunachal Pradesh', 'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Tripura', 'Sikkim']
                    };
                    
                    // Project form region-state filtering
                    const projectRegion = document.getElementById('project-region');
                    const projectLocation = document.getElementById('project-location');
                    
                    projectRegion.addEventListener('change', (e) => {
                        const selectedRegion = e.target.value;
                        projectLocation.innerHTML = '<option value="">Select State</option>';
                        
                        if (selectedRegion && regionStates[selectedRegion]) {
                            regionStates[selectedRegion].forEach(state => {
                                const option = document.createElement('option');
                                option.value = state;
                                option.textContent = state;
                                projectLocation.appendChild(option);
                            });
                        }
                    });
                    
                    document.getElementById('cancel-create').addEventListener('click', () => {
                        document.getElementById('modal-overlay').classList.add('hidden');
                    });
                    
                   document.getElementById('new-project-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    showLoading();

    const formData = new FormData(e.target);

    const projectData = {
        project_name: formData.get('name'),
        project_budget: parseFloat(formData.get('budget')) * 10000000, // crores  rupees
        location: formData.get('location'),
        category: formData.get('region'),
        tower_type: formData.get('towerType'),
        terrain: formData.get('substationType'),
        user_id: parseInt(localStorage.getItem("user_id"))
    };

    try {
        const response = await fetch(`${BACKEND_URL}/projects/create`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(projectData)
        });

        const data = await response.json();

        if (!response.ok) {
            alert("Project creation failed: " + data.detail);
            hideLoading();
            return;
        }

        alert("Project created successfully!");
        document.getElementById('modal-overlay').classList.add('hidden');
        hideLoading();
        renderDashboard();

    } catch (error) {
        console.error(error);
        alert("Could not connect to server.");
        hideLoading();
    }
});

                });
                
                // Use in Forecast buttons
                document.querySelectorAll('.use-in-forecast').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const projectId = btn.dataset.projectId;
                        localStorage.setItem('selectedProjectForForecast', projectId);
                        navigateToPage('forecast');
                    });
                });
                
                // View Details buttons
                document.querySelectorAll('.view-project-details').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const project = JSON.parse(btn.dataset.project);
                        showProjectDetailModal(project);
                    });
                });
            }
            
            // Function to filter and re-render project grid
            function applyProjectFilters() {
                const region = document.getElementById('project-filter-region').value;
                const status = document.getElementById('project-filter-status').value;
                const minCompletion = parseInt(document.getElementById('project-filter-min-completion').value) || 0;
                const maxCompletion = parseInt(document.getElementById('project-filter-max-completion').value) || 100;
                
                let filtered = window.projectsFilterData.filter(p => {
                    const matchRegion = !region || p.region === region;
                    const matchStatus = !status || p.status === status;
                    const matchCompletion = p.completion >= minCompletion && p.completion <= maxCompletion;
                    return matchRegion && matchStatus && matchCompletion;
                });
                
                renderProjectGrid(filtered);
            }
            
            function renderProjectGrid(projects) {
                const grid = document.getElementById('projects-grid');
                grid.innerHTML = projects.map(p => `
                    <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 hover:shadow-lg transition-all">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-mono text-xs text-slate-500">${p.id}</span>
                            <span class="badge ${p.status === 'In Progress' ? 'badge-info' : 'badge-warning'}">${p.status}</span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">${p.name}</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                            <div>
                                <p class="text-slate-500">Region</p>
                                <p class="font-semibold text-slate-700">${p.region || 'N/A'}</p>
                            </div>
                            <div>
                                <p class="text-slate-500">Location</p>
                                <p class="font-semibold text-slate-700">${p.location}</p>
                            </div>
                            <div>
                                <p class="text-slate-500">Budget</p>
                                <p class="font-semibold text-slate-700">${(p.budget / 10000000).toFixed(2)}Cr</p>
                            </div>
                            <div>
                                <p class="text-slate-500">Towers</p>
                                <p class="font-semibold text-slate-700">${p.towerCount}</p>
                            </div>
                            <div>
                                <p class="text-slate-500">Start Date</p>
                                <p class="font-semibold text-slate-700">${p.startDate}</p>
                            </div>
                            <div>
                                <p class="text-slate-500">End Date</p>
                                <p class="font-semibold text-slate-700">${p.endDate}</p>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="flex items-center justify-between text-sm mb-1">
                                <span class="text-slate-600">Progress</span>
                                <span class="font-bold text-teal-600">${p.completion}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${p.completion}%"></div>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-4">
                            <button class="flex-1 btn btn-outline text-sm use-in-forecast" data-project-id="${p.id}">Use in Forecast</button>
                            <button class="btn btn-secondary text-sm view-project-details" data-project='${JSON.stringify(p)}'>View Details</button>
                        </div>
                    </div>
                `).join('');
                
                // Re-attach event listeners
                document.querySelectorAll('.use-in-forecast').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const projectId = btn.dataset.projectId;
                        localStorage.setItem('selectedProjectForForecast', projectId);
                        navigateToPage('forecast');
                    });
                });
                
                document.querySelectorAll('.view-project-details').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const project = JSON.parse(btn.dataset.project);
                        showProjectDetailModal(project);
                    });
                });
            }
            
            // Function to show detailed project view modal
            function showProjectDetailModal(project) {
                document.getElementById('modal-title').textContent = 'Project Details';
                document.getElementById('modal-content').innerHTML = `
                    <div class="space-y-6">
                        <!-- Project Header -->
                        <div class="border-b border-slate-200 pb-4">
                            <div class="flex items-center justify-between mb-2">
                                <h2 class="text-2xl font-bold text-slate-800">${project.name}</h2>
                                <span class="badge ${project.status === 'In Progress' ? 'badge-info' : project.status === 'Planning' ? 'badge-warning' : 'badge-success'}">${project.status}</span>
                            </div>
                            <p class="text-sm text-slate-500 font-mono">${project.id}</p>
                        </div>
                        
                        <!-- Progress Overview -->
                        <div class="bg-gradient-to-r from-teal-50 to-blue-50 p-6 rounded-xl border border-teal-200">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-lg font-bold text-slate-800">Project Progress</h3>
                                <span class="text-3xl font-bold text-teal-600">${project.completion}%</span>
                            </div>
                            <div class="progress-bar h-3">
                                <div class="progress-fill h-3" style="width: ${project.completion}%"></div>
                            </div>
                        </div>
                        
                        <!-- Key Information Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Region</p>
                                <p class="text-lg font-bold text-slate-800">${project.region || 'N/A'}</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Location (State)</p>
                                <p class="text-lg font-bold text-slate-800">${project.location}</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Total Budget</p>
                                <p class="text-lg font-bold text-green-600">${(project.budget / 10000000).toFixed(2)} Crores</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Tower Type</p>
                                <p class="text-lg font-bold text-slate-800">${project.towerType}</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Substation Type</p>
                                <p class="text-lg font-bold text-slate-800">${project.substationType}</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Number of Towers</p>
                                <p class="text-lg font-bold text-slate-800">${project.towerCount}</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Line Length</p>
                                <p class="text-lg font-bold text-slate-800">${project.lineLength} km</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <p class="text-xs text-slate-500 mb-1">Duration</p>
                                <p class="text-lg font-bold text-slate-800">${Math.ceil((new Date(project.endDate) - new Date(project.startDate)) / (1000 * 60 * 60 * 24 * 30))} months</p>
                            </div>
                        </div>
                        
                        <!-- Timeline -->
                        <div class="bg-white border border-slate-200 rounded-lg p-4">
                            <h3 class="text-lg font-bold text-slate-800 mb-4">Project Timeline</h3>
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <p class="text-sm text-slate-500 mb-1">Start Date</p>
                                    <p class="text-xl font-bold text-blue-600">${new Date(project.startDate).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-500 mb-1">End Date</p>
                                    <p class="text-xl font-bold text-purple-600">${new Date(project.endDate).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Location Info -->
                        <div class="bg-white border border-slate-200 rounded-lg p-4">
                            <h3 class="text-lg font-bold text-slate-800 mb-3">Location Details</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Tower Locations:</span>
                                    <span class="font-semibold text-slate-800">${project.towerLocations?.length || 0} points</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Substation Locations:</span>
                                    <span class="font-semibold text-slate-800">${project.substationLocations?.length || 0} points</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex gap-3 pt-4 border-t border-slate-200">
                            <button onclick="localStorage.setItem('selectedProjectForForecast', '${project.id}'); navigateToPage('forecast'); document.getElementById('modal-overlay').classList.add('hidden');" class="flex-1 btn btn-primary">
                                Use in Forecast
                            </button>
                            <button onclick="document.getElementById('modal-overlay').classList.add('hidden');" class="btn btn-secondary">
                                Close
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('modal-overlay').classList.remove('hidden');
            }
            
            async function renderAnalyticsPage() {
                pageTitle.textContent = "Analytics Dashboard";
                const projects = await api.getProjectsSummary();
                const materials = await api.getMaterialsSummary();
                
                // Store original data for filtering
                window.analyticsData = { projects, materials };
                
                mainContent.innerHTML = `
                    <div class="fade-in">
                        <!-- Filters Section -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-6">
                            <h3 class="text-lg font-bold text-slate-800 mb-4">Analysis Filters</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Filter By</label>
                                    <select id="analytics-filter-type" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                        <option value="all">All Projects</option>
                                        <option value="project">Specific Project</option>
                                        <option value="region">By Region</option>
                                    </select>
                                </div>
                                <div id="project-filter-container" class="hidden">
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Select Project</label>
                                    <select id="analytics-project-filter" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                        <option value="">Choose Project</option>
                                        ${projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                                    </select>
                                </div>
                                <div id="region-filter-container" class="hidden">
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Select Region</label>
                                    <select id="analytics-region-filter" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                        <option value="">Choose Region</option>
                                        <option value="North">North</option>
                                        <option value="South">South</option>
                                        <option value="East">East</option>
                                        <option value="West">West</option>
                                        <option value="Central">Central</option>
                                        <option value="North East">North East</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- KPI Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white shadow-lg">
                                <p class="text-sm opacity-90">Total Investment</p>
                                <p class="text-3xl font-bold mt-2">${(projects.reduce((sum, p) => sum + p.budget, 0) / 10000000).toFixed(1)}Cr</p>
                                <p class="text-xs mt-2 opacity-75">Across all projects</p>
                            </div>
                            <div class="bg-gradient-to-br from-teal-500 to-teal-600 p-6 rounded-xl text-white shadow-lg">
                                <p class="text-sm opacity-90">Avg. Completion</p>
                                <p class="text-3xl font-bold mt-2">${(projects.reduce((sum, p) => sum + p.completion, 0) / projects.length).toFixed(1)}%</p>
                                <p class="text-xs mt-2 opacity-75">Project progress</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white shadow-lg">
                                <p class="text-sm opacity-90">Stock Health</p>
                                <p class="text-3xl font-bold mt-2">${((materials.filter(m => m.status === 'Good').length / materials.length) * 100).toFixed(0)}%</p>
                                <p class="text-xs mt-2 opacity-75">Materials adequate</p>
                            </div>
                            <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-6 rounded-xl text-white shadow-lg">
                                <p class="text-sm opacity-90">Total Towers</p>
                                <p class="text-3xl font-bold mt-2">${projects.reduce((sum, p) => sum + p.towerCount, 0)}</p>
                                <p class="text-xs mt-2 opacity-75">In all projects</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Regional Budget Distribution</h3>
                                <canvas id="spend-chart" height="200"></canvas>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Project Status Distribution</h3>
                                <canvas id="category-chart" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Material Demand Forecast Trend (AI Accuracy)</h3>
                                <canvas id="accuracy-chart" height="120"></canvas>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Tower Type Distribution</h3>
                                <canvas id="tower-chart" height="120"></canvas>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Project Completion Progress</h3>
                                <canvas id="timeline-chart" height="150"></canvas>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Critical Material Stock Levels</h3>
                                <canvas id="material-stock-chart" height="150"></canvas>
                            </div>
                        </div>
                    </div>
                `;
                
                // Defer chart rendering to improve initial load performance
                setTimeout(() => {
                    // Regional Budget Distribution Chart
                    const regionalBudget = projects.reduce((acc, p) => {
                        const region = p.region || 'Unassigned';
                        acc[region] = (acc[region] || 0) + (p.budget / 10000000);
                        return acc;
                    }, {});
                    
                    const spendCtx = document.getElementById('spend-chart')?.getContext('2d');
                    if (spendCtx) {
                        new Chart(spendCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(regionalBudget),
                        datasets: [{
                            label: 'Budget Allocated ( Cr)',
                            data: Object.values(regionalBudget),
                            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6'],
                            borderColor: ['#2563eb', '#059669', '#d97706', '#7c3aed', '#db2777', '#0d9488'],
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: true,
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: (context) => `Budget: ${context.parsed.y.toFixed(2)} Crores`
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => `${value}Cr`
                                }
                            }
                        }
                    }
                });
                }
                
                // Project Status Chart
                const statusData = projects.reduce((acc, p) => {
                    acc[p.status] = (acc[p.status] || 0) + 1;
                    return acc;
                }, {});
                
                const categoryCtx = document.getElementById('category-chart')?.getContext('2d');
                if (categoryCtx) {
                    new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(statusData),
                        datasets: [{
                            data: Object.values(statusData),
                            backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#8b5cf6']
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: true,
                        plugins: {
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: (context) => `${context.label}: ${context.parsed} projects`
                                }
                            }
                        }
                    }
                });
                }
                
                // Accuracy Chart
                const accuracyCtx = document.getElementById('accuracy-chart')?.getContext('2d');
                if (accuracyCtx) {
                    new Chart(accuracyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                        datasets: [{
                            label: 'Forecast Accuracy (%)',
                            data: [92, 93.5, 94, 94.5, 95.2, 96.1],
                            borderColor: '#2dd4bf',
                            backgroundColor: 'rgba(45, 212, 191, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#2dd4bf',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: true, 
                        scales: { y: { min: 90, max: 100 } },
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: (context) => `Accuracy: ${context.parsed.y}%`
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            intersect: false
                        }
                    }
                });
                }
                
                // Tower Type Distribution (Type A, B, C, D)
                const towerTypeData = projects.reduce((acc, p) => {
                    const type = p.towerType.includes('Type A') ? 'Type A' : 
                                p.towerType.includes('Type B') ? 'Type B' : 
                                p.towerType.includes('Type C') ? 'Type C' : 
                                p.towerType.includes('Type D') ? 'Type D' : 'Other';
                    acc[type] = (acc[type] || 0) + p.towerCount;
                    return acc;
                }, {});
                
                const towerCtx = document.getElementById('tower-chart')?.getContext('2d');
                if (towerCtx) {
                    new Chart(towerCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(towerTypeData),
                        datasets: [{
                            data: Object.values(towerTypeData),
                            backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6'],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 10, font: { size: 11 } }
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: (context) => `${context.label}: ${context.parsed} towers`
                                }
                            }
                        }
                    }
                });
                }
                
                // Project Completion Progress Chart
                const timelineCtx = document.getElementById('timeline-chart')?.getContext('2d');
                if (timelineCtx) {
                    new Chart(timelineCtx, {
                    type: 'bar',
                    data: {
                        labels: projects.map(p => p.name.substring(0, 25) + '...'),
                        datasets: [{
                            label: 'Completion %',
                            data: projects.map(p => p.completion),
                            backgroundColor: projects.map(p => 
                                p.completion < 30 ? '#ef4444' : 
                                p.completion < 70 ? '#f59e0b' : '#10b981'
                            ),
                            borderRadius: 6,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: { 
                            x: { 
                                max: 100,
                                ticks: {
                                    callback: (value) => value + '%'
                                }
                            }
                        },
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: (context) => `Completion: ${context.parsed.x}%`
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            intersect: false
                        }
                    }
                });
                }
                
                // Critical Material Stock Levels
                const criticalMaterials = materials.filter(m => m.status !== 'Good').slice(0, 6);
                const stockCtx = document.getElementById('material-stock-chart')?.getContext('2d');
                if (stockCtx && criticalMaterials.length > 0) {
                    new Chart(stockCtx, {
                        type: 'bar',
                        data: {
                            labels: criticalMaterials.map(m => m.name.substring(0, 20)),
                            datasets: [
                                {
                                    label: 'Current Stock',
                                    data: criticalMaterials.map(m => m.currentStock),
                                    backgroundColor: criticalMaterials.map(m => 
                                        m.status === 'Critical' ? '#ef4444' : '#f59e0b'
                                    ),
                                    borderRadius: 6
                                },
                                {
                                    label: 'Reorder Level',
                                    data: criticalMaterials.map(m => m.reorderLevel),
                                    backgroundColor: '#10b981',
                                    borderRadius: 6
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: { padding: 15, font: { size: 11 } }
                                },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleColor: '#fff',
                                    bodyColor: '#fff',
                                    padding: 12,
                                    displayColors: true,
                                    callbacks: {
                                        label: (context) => `${context.dataset.label}: ${context.parsed.y.toLocaleString()} ${criticalMaterials[context.dataIndex].unit}`
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => value.toLocaleString()
                                    }
                                }
                            }
                        }
                    });
                }
                }, 100); // Defer charts by 100ms for smoother initial render
                
                // Setup analytics filter listeners
                const filterType = document.getElementById('analytics-filter-type');
                const projectContainer = document.getElementById('project-filter-container');
                const regionContainer = document.getElementById('region-filter-container');
                const projectFilter = document.getElementById('analytics-project-filter');
                const regionFilter = document.getElementById('analytics-region-filter');
                
                filterType.addEventListener('change', (e) => {
                    projectContainer.classList.add('hidden');
                    regionContainer.classList.add('hidden');
                    
                    if (e.target.value === 'project') {
                        projectContainer.classList.remove('hidden');
                    } else if (e.target.value === 'region') {
                        regionContainer.classList.remove('hidden');
                    }
                    
                    // Reset to all when changing filter type
                    if (e.target.value === 'all') {
                        renderAnalyticsCharts(projects);
                    }
                });
                
                projectFilter.addEventListener('change', (e) => {
                    const filtered = e.target.value ? projects.filter(p => p.id === e.target.value) : projects;
                    renderAnalyticsCharts(filtered);
                });
                
                regionFilter.addEventListener('change', (e) => {
                    const filtered = e.target.value ? projects.filter(p => p.region === e.target.value) : projects;
                    renderAnalyticsCharts(filtered);
                });
            }
            
            // Function to re-render charts with filtered data
            function renderAnalyticsCharts(filteredProjects) {
                const materials = window.analyticsData.materials;
                
                // Update KPI cards
                document.querySelector('.grid.grid-cols-1.md\\:grid-cols-4 .from-blue-500 p:last-child').textContent = 
                    `${(filteredProjects.reduce((sum, p) => sum + p.budget, 0) / 10000000).toFixed(1)}Cr`;
                document.querySelector('.grid.grid-cols-1.md\\:grid-cols-4 .from-teal-500 p:nth-child(2)').textContent = 
                    `${filteredProjects.length > 0 ? (filteredProjects.reduce((sum, p) => sum + p.completion, 0) / filteredProjects.length).toFixed(1) : 0}%`;
                document.querySelector('.grid.grid-cols-1.md\\:grid-cols-4 .from-orange-500 p:nth-child(2)').textContent = 
                    filteredProjects.reduce((sum, p) => sum + p.towerCount, 0);
                
                // Destroy and recreate charts
                Chart.helpers.each(Chart.instances, function(instance) {
                    instance.destroy();
                });
                
                setTimeout(() => {
                    // Re-render all charts with filtered data
                    const regionalBudget = filteredProjects.reduce((acc, p) => {
                        const region = p.region || 'Unassigned';
                        acc[region] = (acc[region] || 0) + (p.budget / 10000000);
                        return acc;
                    }, {});
                    
                    const spendCtx = document.getElementById('spend-chart')?.getContext('2d');
                    if (spendCtx) {
                        new Chart(spendCtx, {
                            type: 'bar',
                            data: {
                                labels: Object.keys(regionalBudget),
                                datasets: [{
                                    label: 'Budget Allocated ( Cr)',
                                    data: [4.5, 5.2, 3.8, 6.2, 5.8, 7.1],
                                    backgroundColor: 'rgba(45, 212, 191, 0.8)',
                                    borderColor: '#2dd4bf',
                                    borderWidth: 2
                                }]
                            },
                            options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } } }
                        });
                    }
                    
                    const statusData = filteredProjects.reduce((acc, p) => {
                        acc[p.status] = (acc[p.status] || 0) + 1;
                        return acc;
                    }, {});
                    
                    const categoryCtx = document.getElementById('category-chart')?.getContext('2d');
                    if (categoryCtx) {
                        new Chart(categoryCtx, {
                            type: 'doughnut',
                            data: {
                                labels: Object.keys(statusData),
                                datasets: [{
                                    data: Object.values(statusData),
                                    backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#8b5cf6']
                                }]
                            },
                            options: { 
                                responsive: true, 
                                maintainAspectRatio: true,
                                plugins: {
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        padding: 12,
                                        displayColors: true,
                                        callbacks: {
                                            label: (context) => `${context.label}: ${context.parsed} projects`
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    const accuracyCtx = document.getElementById('accuracy-chart')?.getContext('2d');
                    if (accuracyCtx) {
                        new Chart(accuracyCtx, {
                            type: 'line',
                            data: {
                                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                                datasets: [{
                                    label: 'Forecast Accuracy (%)',
                                    data: [92, 93.5, 94, 94.5, 95.2, 96.1],
                                    borderColor: '#2dd4bf',
                                    backgroundColor: 'rgba(45, 212, 191, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    borderWidth: 3
                                }]
                            },
                            options: { 
                                responsive: true, 
                                maintainAspectRatio: true, 
                                scales: { y: { min: 90, max: 100 } }, 
                                plugins: { 
                                    legend: { display: false },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        padding: 12,
                                        displayColors: false,
                                        callbacks: {
                                            label: (context) => `Accuracy: ${context.parsed.y}%`
                                        }
                                    }
                                },
                                interaction: {
                                    mode: 'nearest',
                                    intersect: false
                                }
                            }
                        });
                    }
                    
                    const towerTypeData = filteredProjects.reduce((acc, p) => {
                        const type = p.towerType.includes('Type A') ? 'Type A' : 
                                    p.towerType.includes('Type B') ? 'Type B' : 
                                    p.towerType.includes('Type C') ? 'Type C' : 
                                    p.towerType.includes('Type D') ? 'Type D' : 'Other';
                        acc[type] = (acc[type] || 0) + p.towerCount;
                        return acc;
                    }, {});
                    
                    const towerCtx = document.getElementById('tower-chart')?.getContext('2d');
                    if (towerCtx) {
                        new Chart(towerCtx, {
                            type: 'doughnut',
                            data: {
                                labels: Object.keys(towerTypeData),
                                datasets: [{
                                    data: Object.values(towerTypeData),
                                    backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6'],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: { 
                                responsive: true, 
                                maintainAspectRatio: true,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: { padding: 10, font: { size: 11 } }
                                    },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        padding: 12,
                                        displayColors: true,
                                        callbacks: {
                                            label: (context) => `${context.label}: ${context.parsed} towers`
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    const timelineCtx = document.getElementById('timeline-chart')?.getContext('2d');
                    if (timelineCtx) {
                        new Chart(timelineCtx, {
                            type: 'bar',
                            data: {
                                labels: filteredProjects.map(p => p.name.substring(0, 25) + '...'),
                                datasets: [{
                                    label: 'Completion %',
                                    data: filteredProjects.map(p => p.completion),
                                    backgroundColor: filteredProjects.map(p => 
                                        p.completion < 30 ? '#ef4444' : 
                                        p.completion < 70 ? '#f59e0b' : '#10b981'
                                    ),
                                    borderRadius: 6,
                                    borderWidth: 0
                                }]
                            },
                            options: { 
                                indexAxis: 'y',
                                responsive: true, 
                                maintainAspectRatio: true,
                                scales: { 
                                    x: { 
                                        max: 100,
                                        ticks: {
                                            callback: (value) => value + '%'
                                        }
                                    }
                                },
                                plugins: { 
                                    legend: { display: false },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        padding: 12,
                                        displayColors: true,
                                        callbacks: {
                                            label: (context) => `Completion: ${context.parsed.x}%`
                                        }
                                    }
                                },
                                interaction: {
                                    mode: 'nearest',
                                    intersect: false
                                }
                            }
                        });
                    }
                    
                    // Critical Material Stock Levels
                    const criticalMaterials = materials.filter(m => m.status !== 'Good').slice(0, 6);
                    const stockCtx = document.getElementById('material-stock-chart')?.getContext('2d');
                    if (stockCtx && criticalMaterials.length > 0) {
                        new Chart(stockCtx, {
                            type: 'bar',
                            data: {
                                labels: criticalMaterials.map(m => m.name.substring(0, 20)),
                                datasets: [
                                    {
                                        label: 'Current Stock',
                                        data: criticalMaterials.map(m => m.currentStock),
                                        backgroundColor: criticalMaterials.map(m => 
                                            m.status === 'Critical' ? '#ef4444' : '#f59e0b'
                                        ),
                                        borderRadius: 6
                                    },
                                    {
                                        label: 'Reorder Level',
                                        data: criticalMaterials.map(m => m.reorderLevel),
                                        backgroundColor: '#10b981',
                                        borderRadius: 6
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: { padding: 15, font: { size: 11 } }
                                    },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        padding: 12,
                                        displayColors: true,
                                        callbacks: {
                                            label: (context) => `${context.dataset.label}: ${context.parsed.y.toLocaleString()} ${criticalMaterials[context.dataIndex].unit}`
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: (value) => value.toLocaleString()
                                        }
                                    }
                                }
                            }
                        });
                    }
                }, 100);
            }
            
            async function renderProcurementPage() {
                showLoading();
                pageTitle.textContent = "Procurement Orders";
                const orders = await api.getProcurementOrders();
                
                mainContent.innerHTML = `
                    <div class="fade-in">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-slate-800">Purchase Orders</h2>
                                <button class="btn btn-primary">Create New Order</button>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>PO Number</th>
                                            <th>Material</th>
                                            <th>Quantity</th>
                                            <th>Supplier</th>
                                            <th>Order Date</th>
                                            <th>Expected Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${orders.map(o => `
                                            <tr>
                                                <td class="font-mono text-xs font-semibold">${o.id}</td>
                                                <td>${o.material}</td>
                                                <td>${o.quantity.toLocaleString()}</td>
                                                <td>${o.supplier}</td>
                                                <td>${o.orderDate}</td>
                                                <td>${o.expectedDate}</td>
                                                <td><span class="badge ${o.status === 'In Transit' ? 'badge-info' : 'badge-warning'}">${o.status}</span></td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                hideLoading();
            }
            
            async function renderReportsPage() {
                pageTitle.textContent = "Reports & Analytics";
                const projects = await api.getProjectsSummary();
                const materials = await api.getMaterialsSummary();
                
                mainContent.innerHTML = `
                    <div class="fade-in">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-lg transition-all cursor-pointer">
                                <svg class="w-12 h-12 text-teal-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                <h3 class="text-lg font-bold text-slate-800 mb-2">Inventory Report</h3>
                                <p class="text-sm text-slate-600 mb-4">Complete stock analysis and valuation</p>
                                <button class="btn btn-outline w-full text-sm report-btn" data-report="inventory">Generate Report</button>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-lg transition-all cursor-pointer">
                                <svg class="w-12 h-12 text-blue-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <h3 class="text-lg font-bold text-slate-800 mb-2">Financial Summary</h3>
                                <p class="text-sm text-slate-600 mb-4">Procurement costs and budget analysis</p>
                                <button class="btn btn-outline w-full text-sm report-btn" data-report="financial">Generate Report</button>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-lg transition-all cursor-pointer">
                                <svg class="w-12 h-12 text-purple-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                <h3 class="text-lg font-bold text-slate-800 mb-2">Forecast Performance</h3>
                                <p class="text-sm text-slate-600 mb-4">AI model accuracy metrics</p>
                                <button class="btn btn-outline w-full text-sm report-btn" data-report="forecast">Generate Report</button>
                            </div>
                        </div>
                        
                        <div id="report-display" class="hidden"></div>
                    </div>
                `;
                
                // Add report generation functionality
                document.querySelectorAll('.report-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const reportType = btn.dataset.report;
                        const reportDisplay = document.getElementById('report-display');
                        
                        btn.innerHTML = '<svg class="animate-spin h-5 w-5 inline" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Generating...';
                        
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        btn.innerHTML = ' Report Generated';
                        btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
                        
                        // Generate report content based on type
                        let reportHTML = '';
                        const reportDate = new Date().toLocaleDateString('en-IN', { dateStyle: 'long' });
                        
                        if (reportType === 'inventory') {
                            const totalValue = materials.reduce((sum, m) => sum + (m.currentStock * 5000), 0);
                            const criticalItems = materials.filter(m => m.status === 'Critical').length;
                            const lowStockItems = materials.filter(m => m.status === 'Low').length;
                            
                            reportHTML = `
                                <div class="fade-in bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-slate-200">
                                        <div>
                                            <h2 class="text-3xl font-bold text-slate-800">Inventory Analysis Report</h2>
                                            <p class="text-sm text-slate-500 mt-1">Generated on ${reportDate}</p>
                                        </div>
                                        <div class="text-right">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='40' viewBox='0 0 120 40'%3E%3Ctext x='0' y='25' font-family='Arial,sans-serif' font-size='20' font-weight='bold' fill='%23064E3B'%3EPOWERGRID%3C/text%3E%3C/svg%3E" alt="POWERGRID">
                                            <p class="text-xs text-slate-500 mt-1">Report ID: INV-${Date.now()}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                        <div class="bg-gradient-to-br from-teal-500 to-teal-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Total Materials</p>
                                            <p class="text-3xl font-bold mt-2">${materials.length}</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Total Value</p>
                                            <p class="text-3xl font-bold mt-2">${(totalValue / 10000000).toFixed(1)}Cr</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-amber-500 to-amber-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Low Stock</p>
                                            <p class="text-3xl font-bold mt-2">${lowStockItems}</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-red-500 to-red-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Critical Items</p>
                                            <p class="text-3xl font-bold mt-2">${criticalItems}</p>
                                        </div>
                                    </div>
                                    
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">Detailed Stock Analysis</h3>
                                    <div class="overflow-x-auto">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Material ID</th>
                                                    <th>Material Name</th>
                                                    <th>Category</th>
                                                    <th>Current Stock</th>
                                                    <th>Reorder Level</th>
                                                    <th>Status</th>
                                                    <th>Est. Value ()</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${materials.map(m => `
                                                    <tr>
                                                        <td class="font-mono text-xs">${m.id}</td>
                                                        <td class="font-semibold">${m.name}</td>
                                                        <td>${m.category}</td>
                                                        <td>${m.currentStock.toLocaleString()} ${m.unit}</td>
                                                        <td>${m.reorderLevel.toLocaleString()}</td>
                                                        <td><span class="badge ${m.status === 'Good' ? 'badge-success' : m.status === 'Low' ? 'badge-warning' : 'badge-danger'}">${m.status}</span></td>
                                                        <td>${(m.currentStock * 5000).toLocaleString()}</td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="mt-8 flex gap-4">
                                        <button class="btn btn-primary" onclick="window.print()">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                                            Print Report
                                        </button>
                                        <button class="btn btn-outline">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                            Download PDF
                                        </button>
                                    </div>
                                </div>
                            `;
                        } else if (reportType === 'financial') {
                            const totalBudget = projects.reduce((sum, p) => sum + p.budget, 0);
                            const avgProjectCost = totalBudget / projects.length;
                            const completedProjects = projects.filter(p => p.completion === 100).length;
                            
                            reportHTML = `
                                <div class="fade-in bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-slate-200">
                                        <div>
                                            <h2 class="text-3xl font-bold text-slate-800">Financial Summary Report</h2>
                                            <p class="text-sm text-slate-500 mt-1">Generated on ${reportDate}</p>
                                        </div>
                                        <div class="text-right">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='40' viewBox='0 0 120 40'%3E%3Ctext x='0' y='25' font-family='Arial,sans-serif' font-size='20' font-weight='bold' fill='%23064E3B'%3EPOWERGRID%3C/text%3E%3C/svg%3E" alt="POWERGRID">
                                            <p class="text-xs text-slate-500 mt-1">Report ID: FIN-${Date.now()}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Total Investment</p>
                                            <p class="text-3xl font-bold mt-2">${(totalBudget / 10000000).toFixed(1)}Cr</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Avg Project Cost</p>
                                            <p class="text-3xl font-bold mt-2">${(avgProjectCost / 10000000).toFixed(1)}Cr</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Active Projects</p>
                                            <p class="text-3xl font-bold mt-2">${projects.length}</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-teal-500 to-teal-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">ROI Estimate</p>
                                            <p class="text-3xl font-bold mt-2">18.5%</p>
                                        </div>
                                    </div>
                                    
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">Project Budget Breakdown</h3>
                                    <div class="overflow-x-auto">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Project ID</th>
                                                    <th>Project Name</th>
                                                    <th>Location</th>
                                                    <th>Budget ()</th>
                                                    <th>Completion</th>
                                                    <th>Spent ()</th>
                                                    <th>Remaining ()</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${projects.map(p => {
                                                    const spent = (p.budget * p.completion / 100);
                                                    const remaining = p.budget - spent;
                                                    return `
                                                        <tr>
                                                            <td class="font-mono text-xs">${p.id}</td>
                                                            <td class="font-semibold">${p.name}</td>
                                                            <td>${p.location}</td>
                                                            <td>${(p.budget / 10000000).toFixed(2)}Cr</td>
                                                            <td><span class="badge badge-info">${p.completion}%</span></td>
                                                            <td>${(spent / 10000000).toFixed(2)}Cr</td>
                                                            <td>${(remaining / 10000000).toFixed(2)}Cr</td>
                                                        </tr>
                                                    `;
                                                }).join('')}
                                            </tbody>
                                            <tfoot>
                                                <tr class="bg-slate-50 font-bold text-lg">
                                                    <td colspan="3" class="text-right">Total:</td>
                                                    <td>${(totalBudget / 10000000).toFixed(2)}Cr</td>
                                                    <td colspan="3"></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    
                                    <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div class="bg-slate-50 p-6 rounded-xl">
                                            <h4 class="font-bold text-slate-800 mb-3">Budget Utilization</h4>
                                            <div class="space-y-3">
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Materials & Equipment</span>
                                                        <span class="font-bold">45%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill" style="width: 45%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Labor & Contractors</span>
                                                        <span class="font-bold">30%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill" style="width: 30%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Transportation & Logistics</span>
                                                        <span class="font-bold">15%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill" style="width: 15%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Miscellaneous</span>
                                                        <span class="font-bold">10%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill" style="width: 10%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-slate-50 p-6 rounded-xl">
                                            <h4 class="font-bold text-slate-800 mb-3">Key Financial Metrics</h4>
                                            <div class="space-y-4">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-slate-600">Cost Variance</span>
                                                    <span class="font-bold text-green-600">-2.3%</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-slate-600">Schedule Performance</span>
                                                    <span class="font-bold text-teal-600">98.5%</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-slate-600">Budget Utilization Rate</span>
                                                    <span class="font-bold text-blue-600">67.8%</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-slate-600">Forecasted Completion</span>
                                                    <span class="font-bold text-purple-600">Q4 2025</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-8 flex gap-4">
                                        <button class="btn btn-primary" onclick="window.print()">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                                            Print Report
                                        </button>
                                        <button class="btn btn-outline">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                            Download PDF
                                        </button>
                                    </div>
                                </div>
                            `;
                        } else if (reportType === 'forecast') {
                            reportHTML = `
                                <div class="fade-in bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-slate-200">
                                        <div>
                                            <h2 class="text-3xl font-bold text-slate-800">AI Forecast Performance Report</h2>
                                            <p class="text-sm text-slate-500 mt-1">Generated on ${reportDate}</p>
                                        </div>
                                        <div class="text-right">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='40' viewBox='0 0 120 40'%3E%3Ctext x='0' y='25' font-family='Arial,sans-serif' font-size='20' font-weight='bold' fill='%23064E3B'%3EPOWERGRID%3C/text%3E%3C/svg%3E" alt="POWERGRID">
                                            <p class="text-xs text-slate-500 mt-1">Report ID: FC-${Date.now()}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Model Accuracy</p>
                                            <p class="text-3xl font-bold mt-2">96.2%</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-teal-500 to-teal-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Forecasts Generated</p>
                                            <p class="text-3xl font-bold mt-2">1,247</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Cost Savings</p>
                                            <p class="text-3xl font-bold mt-2">12.5Cr</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
                                            <p class="text-sm opacity-90">Avg Confidence</p>
                                            <p class="text-3xl font-bold mt-2">94.8%</p>
                                        </div>
                                    </div>
                                    
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">Monthly Accuracy Trends</h3>
                                    <div class="bg-slate-50 p-6 rounded-xl mb-6">
                                        <canvas id="forecast-performance-chart" height="100"></canvas>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                        <div class="bg-slate-50 p-6 rounded-xl">
                                            <h4 class="font-bold text-slate-800 mb-4">Prediction Accuracy by Category</h4>
                                            <div class="space-y-3">
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Steel & Towers</span>
                                                        <span class="font-bold text-green-600">97.5%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill bg-green-500" style="width: 97.5%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Conductors & Cables</span>
                                                        <span class="font-bold text-green-600">95.8%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill bg-green-500" style="width: 95.8%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Transformers</span>
                                                        <span class="font-bold text-green-600">94.2%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill bg-green-500" style="width: 94.2%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between text-sm mb-1">
                                                        <span>Insulators</span>
                                                        <span class="font-bold text-teal-600">96.7%</span>
                                                    </div>
                                                    <div class="progress-bar h-3">
                                                        <div class="progress-fill" style="width: 96.7%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-slate-50 p-6 rounded-xl">
                                            <h4 class="font-bold text-slate-800 mb-4">AI Model Insights</h4>
                                            <div class="space-y-3">
                                                <div class="flex items-start gap-3">
                                                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                                    <span class="text-sm text-slate-700">Accuracy improved by 2.3% this quarter</span>
                                                </div>
                                                <div class="flex items-start gap-3">
                                                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                                    <span class="text-sm text-slate-700">Reduced forecasting time by 45%</span>
                                                </div>
                                                <div class="flex items-start gap-3">
                                                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                                    <span class="text-sm text-slate-700">Zero critical forecast failures</span>
                                                </div>
                                                <div class="flex items-start gap-3">
                                                    <svg class="w-5 h-5 text-teal-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                                    <span class="text-sm text-slate-700">Model trained on 50,000+ historical data points</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg">
                                        <div class="flex items-start gap-3">
                                            <svg class="w-6 h-6 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-blue-800 mb-2">Recommendation</h4>
                                                <p class="text-sm text-blue-700">The AI model is performing exceptionally well with 96.2% accuracy. Consider expanding the training dataset with regional variations to improve accuracy for North East projects.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-8 flex gap-4">
                                        <button class="btn btn-primary" onclick="window.print()">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                                            Print Report
                                        </button>
                                        <button class="btn btn-outline">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                            Download PDF
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                        
                        reportDisplay.innerHTML = reportHTML;
                        reportDisplay.classList.remove('hidden');
                        reportDisplay.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        
                        // Render chart for forecast performance report
                        if (reportType === 'forecast') {
                            setTimeout(() => {
                                const ctx = document.getElementById('forecast-performance-chart')?.getContext('2d');
                                if (ctx) {
                                    new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                            datasets: [{
                                                label: 'Accuracy %',
                                                data: [92.1, 93.5, 94.2, 94.8, 95.1, 95.4, 95.8, 96.0, 96.1, 96.0, 96.2, 96.2],
                                                borderColor: '#2dd4bf',
                                                backgroundColor: 'rgba(45, 212, 191, 0.1)',
                                                tension: 0.4,
                                                fill: true,
                                                borderWidth: 3
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: true,
                                            plugins: {
                                                legend: { display: false }
                                            },
                                            scales: {
                                                y: { 
                                                    beginAtZero: false,
                                                    min: 90,
                                                    max: 100
                                                }
                                            }
                                        }
                                    });
                                }
                            }, 100);
                        }
                        
                        // Reset button after some time
                        setTimeout(() => {
                            btn.innerHTML = 'Generate Report';
                            btn.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                        }, 3000);
                    });
                });
            }
            
            async function renderSettingsPage() {
                pageTitle.textContent = "Settings";
                const currentUser = auth.currentUser;
                
                mainContent.innerHTML = `
                    <div class="fade-in max-w-4xl">
                        <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800 mb-6">Account Settings</h2>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Email Address</label>
                                    <input type="email" value="${currentUser?.email || 'user@powergrid.in'}" disabled class="w-full bg-slate-100" />
                                    <p class="text-xs text-slate-500 mt-1">Email cannot be changed</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">User ID</label>
                                    <input type="text" value="${currentUser?.uid?.substring(0, 16) || 'N/A'}..." disabled class="w-full bg-slate-100" />
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Account Created</label>
                                    <input type="text" value="${currentUser?.metadata?.creationTime || 'N/A'}" disabled class="w-full bg-slate-100" />
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800 mb-6">Notification Preferences</h2>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-lg">
                                    <div>
                                        <p class="font-semibold text-slate-800">Low Stock Alerts</p>
                                        <p class="text-sm text-slate-600">Get notified when materials reach reorder level</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-lg">
                                    <div>
                                        <p class="font-semibold text-slate-800">Project Updates</p>
                                        <p class="text-sm text-slate-600">Receive updates on project milestones</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-lg">
                                    <div>
                                        <p class="font-semibold text-slate-800">Forecast Reports</p>
                                        <p class="text-sm text-slate-600">Weekly AI forecast accuracy reports</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800 mb-6">Display Settings</h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Dashboard Theme</label>
                                    <select id="theme-selector" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                        <option value="light" selected>Light Mode</option>
                                        <option value="dark">Dark Mode</option>
                                        <option value="auto">Auto (System)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Date Format</label>
                                    <select id="date-format-selector" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                        <option value="dd-mm-yyyy" selected>DD-MM-YYYY</option>
                                        <option value="mm-dd-yyyy">MM-DD-YYYY</option>
                                        <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Currency Display</label>
                                    <select id="currency-selector" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-jungle-green focus:border-jungle-green">
                                        <option value="inr" selected>Indian Rupee ()</option>
                                        <option value="usd">US Dollar ($)</option>
                                    </select>
                                </div>
                                <div class="pt-4">
                                    <button id="save-display-settings" class="btn btn-primary w-full">Apply Settings</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800 mb-6">Data Management</h2>
                            <div class="space-y-4">
                                <button class="w-full btn btn-outline flex items-center justify-center gap-2 export-data-btn">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                    Export All Data
                                </button>
                                <button class="w-full btn btn-outline flex items-center justify-center gap-2 import-data-btn">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                    Import Project Data
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 border border-red-200 p-8 rounded-xl">
                            <h2 class="text-2xl font-bold text-red-800 mb-4">Danger Zone</h2>
                            <p class="text-sm text-red-700 mb-4">These actions are irreversible. Please proceed with caution.</p>
                            <button class="btn text-white bg-red-600 hover:bg-red-700 border-none">Delete Account</button>
                        </div>
                        
                        <div class="flex justify-end gap-4 mt-6">
                            <button class="btn btn-secondary">Cancel</button>
                            <button class="btn btn-primary">Save Changes</button>
                        </div>
                    </div>
                `;
                
                // Load saved settings
                const savedTheme = localStorage.getItem('dashboardTheme') || 'light';
                const savedDateFormat = localStorage.getItem('dateFormat') || 'dd-mm-yyyy';
                const savedCurrency = localStorage.getItem('currency') || 'inr';
                
                document.getElementById('theme-selector').value = savedTheme;
                document.getElementById('date-format-selector').value = savedDateFormat;
                document.getElementById('currency-selector').value = savedCurrency;
                
                // Apply current theme
                applyTheme(savedTheme);
                
                // Theme selector change
                document.getElementById('theme-selector').addEventListener('change', (e) => {
                    const theme = e.target.value;
                    applyTheme(theme);
                });
                
                // Save display settings
                document.getElementById('save-display-settings')?.addEventListener('click', () => {
                    const theme = document.getElementById('theme-selector').value;
                    const dateFormat = document.getElementById('date-format-selector').value;
                    const currency = document.getElementById('currency-selector').value;
                    
                    localStorage.setItem('dashboardTheme', theme);
                    localStorage.setItem('dateFormat', dateFormat);
                    localStorage.setItem('currency', currency);
                    
                    applyTheme(theme);
                    
                    alert('Display settings saved successfully!');
                });
                
                // Export data functionality
                document.querySelector('.export-data-btn')?.addEventListener('click', () => {
                    const data = JSON.stringify(projectsData, null, 2);
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `powergrid-data-${Date.now()}.json`;
                    a.click();
                    alert('Data exported successfully!');
                });
                
                // Import data functionality
                document.querySelector('.import-data-btn')?.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const imported = JSON.parse(event.target.result);
                                projectsData.push(...imported);
                                alert('Data imported successfully!');
                            } catch (err) {
                                alert('Error importing data: ' + err.message);
                            }
                        };
                        reader.readAsText(file);
                    };
                    input.click();
                });
            }
            
            function attachQuickActionListeners() {
                document.querySelectorAll('.quick-action-btn, [data-page]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = btn.dataset.page;
                        if (page) navigateToPage(page);
                    });
                });
            }
            
            function navigateToPage(page) {
                // Update nav active state
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.dataset.page === page) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                // Render appropriate page
                switch(page) {
                    case 'dashboard': renderDashboard(); break;
                    case 'forecast': 
                        renderForecastPage().then(() => {
                            // Auto-select project if coming from project page
                            const selectedProjectId = localStorage.getItem('selectedProjectForForecast');
                            if (selectedProjectId) {
                                const selector = document.getElementById('project-selector');
                                if (selector) {
                                    selector.value = selectedProjectId;
                                    selector.dispatchEvent(new Event('change'));
                                    document.getElementById('project-selection-card').classList.remove('hidden');
                                }
                                localStorage.removeItem('selectedProjectForForecast');
                            }
                        });
                        break;
                    case 'inventory': renderInventoryPage(); break;
                    case 'projects': renderProjectsPage(); break;
                    case 'analytics': renderAnalyticsPage(); break;
                    case 'procurement': renderProcurementPage(); break;
                    case 'reports': renderReportsPage(); break;
                    case 'settings': renderSettingsPage(); break;
                }
            }
            
            // Attach nav listeners
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateToPage(link.dataset.page);
                });
            });
            
            // Sidebar toggle functionality
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                });
            }
            
            // Modal close button
            const modalClose = document.getElementById('modal-close');
            const modalOverlay = document.getElementById('modal-overlay');
            
            if (modalClose) {
                modalClose.addEventListener('click', () => {
                    modalOverlay.classList.add('hidden');
                });
            }
            
            // Click outside modal to close
            if (modalOverlay) {
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        modalOverlay.classList.add('hidden');
                    }
                });
            }
            
            function showLoading() {
                loadingOverlay.classList.remove('hidden');
            }
            
            function hideLoading() {
                loadingOverlay.classList.add('hidden');
            }
        });
    </script>
</body>
</html>